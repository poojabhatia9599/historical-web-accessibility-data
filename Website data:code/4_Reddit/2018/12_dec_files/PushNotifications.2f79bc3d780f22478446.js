var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

(window.webpackJsonp=window.webpackJsonp||[]).push([["PushNotifications"],{"./src/lib/timezone/index.ts":function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s}),i.d(t,"d",function(){return a}),i.d(t,"c",function(){return c}),i.d(t,"e",function(){return u});var n=i("./src/lib/constants/index.ts"),r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(c){r=!0,o=c}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const o="America/Los_Angeles",s=()=>{let e;try{e=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(t){}return"Asia/Calcutta"===e&&(e="Asia/Kolkata"),e||void 0},a=e=>{const t=Math.abs(e),i=t%60;return`${e>0?"-":"+"}${("0"+Math.floor(t/60)).slice(-2)}:${("0"+i).slice(-2)}`},c=(e,t)=>{const i=t||Date.now(),o={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short",hour12:!1,timeZone:e};let s="";try{s=new Intl.DateTimeFormat("en-US",o).format(new Date(i))}catch(N){return}var a=s.replace(", "," ").split(" "),c=r(a,3);const u=c[0],l=c[1],d=c[2];var p=u.trim().split("/").map(Number),f=r(p,3);const b=f[0],g=f[1],m=f[2];var v=l.trim().split(":").map(Number),w=r(v,3);const h=w[0],O=w[1],S=w[2],j=Date.UTC(m,b-1,g,h,O,S),y=new Date(i).setMilliseconds(0)-j;return{abbreviation:d,offset:Math.round(y/n.Ga)}},u=e=>{var t=e.slice(0,19).split("T"),i=r(t,2);const n=i[0],o=i[1];var s=n.split("-").map(Number),a=r(s,3);const c=a[0],u=a[1],l=a[2];var d=o.split(":").map(Number),p=r(d,3);const f=p[0],b=p[1];var g=p[2];return new Date(c,u-1,l,f,b,void 0===g?0:g)}},"./src/reddit/actions/notifications.ts":function(e,t,i){"use strict";i.r(t);var n=i("./src/config.ts"),r=i("./src/lib/constants/index.ts"),o=i("./src/lib/localStorageAvailable/index.ts"),s=i("./src/lib/makeGqlRequest/index.ts"),a=i("./src/lib/timezone/index.ts"),c=i("./src/reddit/featureFlags/index.ts");var u=i("./src/reddit/selectors/telemetry.ts"),l=i("./src/telemetry/index.ts");const d=e=>Object.assign({},u.defaults(e),{noun:"desktop_notification_permissions"}),p=(e,t,i)=>Object.assign({},u.defaults(e),{actionInfo:u.actionInfo(e,{success:t,reason:i}),noun:"desktop_push_token"}),f=(e,t)=>{Object(l.a)(Object.assign({},p(e,!1,t),{action:"bail",source:"notifications"}))},b=e=>Object.assign({},u.defaults(e),{noun:"desktop_push_notification"});var g=i("./src/reddit/selectors/user.ts");i.d(t,"checkPushNotificationSupport",function(){return w}),i.d(t,"getBrowserNotificationPermission",function(){return O}),i.d(t,"resetPermissionRequestClosed",function(){return S}),i.d(t,"isBrowserSubscribedForPushNotifications",function(){return j}),i.d(t,"initializeServiceWorkerChannel",function(){return y}),i.d(t,"requestNotificationsPermissions",function(){return N}),i.d(t,"subscribeForPNs",function(){return _});const m=4*r.K;var v;!function(e){e[e.NotificationsSupported=0]="NotificationsSupported",e[e.BrowserUnsupported=1]="BrowserUnsupported",e[e.LocalStorageUnavailable=2]="LocalStorageUnavailable",e[e.NotAllRequiredAPIsSupported=3]="NotAllRequiredAPIsSupported"}(v||(v={}));const w=e=>c.d.pushNotificationsBrowserSupported(e)?Object(o.a)()?window.Notification&&window.ServiceWorker&&window.PushManager?v.NotificationsSupported:v.NotAllRequiredAPIsSupported:v.LocalStorageUnavailable:v.BrowserUnsupported;var h;!function(e){e[e.Granted=0]="Granted",e[e.Denied=1]="Denied",e[e.Closed=2]="Closed",e[e.Default=3]="Default"}(h||(h={}));const O=()=>{const e=Object(o.a)()&&"1"===localStorage.getItem("notification-permission-request-closed");return"granted"===Notification.permission?h.Granted:"denied"===Notification.permission?h.Denied:e?h.Closed:h.Default},S=()=>!!Object(o.a)()&&(localStorage.removeItem("notification-permission-request-closed"),!0),j=async()=>{let e;try{e=await navigator.serviceWorker.register("/sw.js")}catch(t){return!1}return null!==await e.pushManager.getSubscription()},y=async e=>{if(w(e)===v.NotificationsSupported){try{await navigator.serviceWorker.register("/sw.js")}catch(t){return}navigator.serviceWorker.addEventListener("message",t=>{const i=t.data;if("logInteraction"===i.command){const t=i.interactionType,n=i.payload.correlation_id;"push"===t?((e,t)=>{Object(l.a)(Object.assign({},b(e),{action:"receive",source:"notifications",correlationId:t}))})(e,n):"notificationclick"===t?((e,t)=>{Object(l.a)(Object.assign({},b(e),{action:"click",source:"notifications",correlationId:t}))})(e,n):"notificationclose"===t&&((e,t)=>{Object(l.a)(Object.assign({},b(e),{action:"close",source:"notifications",correlationId:t}))})(e,n)}})}},N=e=>async(t,i,n)=>{const r=i();if(!Object(g.A)(r))return;if(await y(r),Object(o.a)()){const t=localStorage.getItem("push-token-last-refresh-ms"),i=(new Date).getTime();if(!e&&t&&parseInt(t)+m>i)return;localStorage.setItem("push-token-last-refresh-ms",i.toString())}(e=>{Object(l.a)(Object.assign({},p(e,!0,""),{action:"request",source:"notifications"}))})(r);const s=w(r);if(s===v.BrowserUnsupported)return void f(r,"unsupported_browser");if(s===v.LocalStorageUnavailable)return void f(r,"local_storage_unavailable");if(s===v.NotAllRequiredAPIsSupported)return void f(r,"not_all_push_apis_supported");if("denied"===Notification.permission)return void f(r,"already_denied");if("granted"===Notification.permission)return void t(_());const a=localStorage.getItem("notification-permission-request-closed");if(a&&"1"===a)f(r,"notification_permission_request_closed");else switch((e=>{Object(l.a)(Object.assign({},d(e),{action:"view",source:"popup"}))})(r),await Notification.requestPermission()){case"granted":t(_()),(e=>{Object(l.a)(Object.assign({},d(e),{action:"allow",source:"popup"}))})(r);break;case"denied":(e=>{Object(l.a)(Object.assign({},d(e),{action:"block",source:"popup"}))})(r);break;default:(e=>{Object(l.a)(Object.assign({},d(e),{action:"close",source:"popup"}))})(r),localStorage.setItem("notification-permission-request-closed","1")}},_=()=>async(e,t,i)=>{const r=t();try{const e=await navigator.serviceWorker.register("/sw.js");let c=await e.pushManager.getSubscription();if(!c){const t={userVisibleOnly:!0,applicationServerKey:(e=>{const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),n=new Uint8Array(i.length);for(let r=0;r<i.length;++r)n[r]=i.charCodeAt(r);return n})(n.a.pushNotificationApplicationServerKey)};c=await e.pushManager.subscribe(t)}const u=await((e,t,i)=>{const n={pushToken:JSON.stringify(i),timezoneName:Object(a.b)()||a.a,timestamp:(new Date).toISOString(),language:"en_us"};return Object(s.a)(e,{id:"033b409ffde6",variables:n})})(i.gqlContext(),t(),c),d=u.body.data.registerWebPushToken;u.ok?d&&!d.ok?f(r,"registration_failed_in_gql"):(e=>{Object(l.a)(Object.assign({},p(e,!0,""),{action:"register",source:"notifications"}))})(r):f(r,"registration_failed_generally")}catch(o){f(r,"registration_failed_uncaught_exception")}}}}]);
//# sourceMappingURL=PushNotifications.2f79bc3d780f22478446.js.map

}
/*
     FILE ARCHIVED ON 18:46:33 Nov 30, 2018 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:36:05 Feb 19, 2024.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  exclusion.robots: 0.133
  exclusion.robots.policy: 0.115
  cdx.remote: 0.204
  esindex: 0.018
  LoadShardBlock: 93.73 (6)
  PetaboxLoader3.datanode: 168.31 (8)
  load_resource: 601.796 (2)
  PetaboxLoader3.resolve: 459.696 (2)
*/
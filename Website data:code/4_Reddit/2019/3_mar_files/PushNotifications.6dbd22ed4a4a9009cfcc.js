var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

(window.webpackJsonp=window.webpackJsonp||[]).push([["PushNotifications"],{"./src/graphql/operations/RegisterWebPushToken.json":function(t){t.exports={id:"197650c1946c"}},"./src/lib/timezone/index.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a}),n.d(e,"e",function(){return c}),n.d(e,"d",function(){return u}),n.d(e,"f",function(){return d}),n.d(e,"g",function(){return l}),n.d(e,"c",function(){return f});var r=n("./src/lib/constants/index.ts"),i=n("./src/reddit/models/PostCreationForm/index.ts"),s=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(c){i=!0,s=c}finally{try{!r&&a.return&&a.return()}finally{if(i)throw s}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const o="America/Los_Angeles",a=()=>{let t;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}return"Asia/Calcutta"===t&&(t="Asia/Kolkata"),t||void 0},c=t=>{const e=Math.abs(t),n=e%60;return`${t>0?"-":"+"}${("0"+Math.floor(e/60)).slice(-2)}:${("0"+n).slice(-2)}`},u=(t,e)=>{const n=e||Date.now(),i={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short",hour12:!1,timeZone:t};let o="";try{o=new Intl.DateTimeFormat("en-US",i).format(new Date(n))}catch(S){return}var a=o.replace(", "," ").split(" "),c=s(a,3);const u=c[0],d=c[1],l=c[2];var f=u.trim().split("/").map(Number),p=s(f,3);const b=p[0],g=p[1],m=p[2];var v=d.trim().split(":").map(Number),h=s(v,3);const j=h[0],w=h[1],O=h[2],k=Date.UTC(m,b-1,g,j,w,O),_=new Date(n).setMilliseconds(0)-k;return{abbreviation:l,offset:Math.round(_/r.kb)}},d=t=>{var e=t.slice(0,19).split("T"),n=s(e,2);const r=n[0],i=n[1];var o=r.split("-").map(Number),a=s(o,3);const c=a[0],u=a[1],d=a[2];var l=i.split(":").map(Number),f=s(l,3);const p=f[0],b=f[1];var g=f[2];return new Date(c,u-1,d,p,b,void 0===g?0:g)},l=t=>{const e=new Date(t);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.toISOString().slice(0,16)},f=t=>{if(t&&t.eventInfo){var e=t.eventInfo;const n=e.eventStart,s=e.eventEnd;return{startDate:l(new Date(n*r.Wb)),endDate:l(new Date(s*r.Wb)),submitTime:i.i.Now,timezoneName:a()||o}}}},"./src/reddit/actions/notifications/index.ts":function(t,e,n){"use strict";n.r(e);var r=n("./src/config.ts"),i=n("./src/lib/browser/isIncognito.ts"),s=n("./src/lib/constants/index.ts"),o=n("./src/lib/localStorageAvailable/index.ts"),a=n("./src/reddit/actions/notifications/constants.ts"),c=n("./src/reddit/actions/notifications/utils.ts"),u=n("./src/graphql/operations/RegisterWebPushToken.json"),d=n("./src/lib/makeGqlRequest/index.ts"),l=n("./src/lib/timezone/index.ts");var f=n("./src/reddit/helpers/trackers/notifications.ts"),p=n("./src/reddit/selectors/experiments/dnPrePrompt.ts"),b=n("./src/reddit/selectors/notificationPrefs.ts"),g=n("./src/reddit/selectors/user.ts");n.d(e,"getBrowserNotificationPermission",function(){return v}),n.d(e,"resetPermissionRequestClosed",function(){return h}),n.d(e,"isBrowserSubscribedForPushNotifications",function(){return j}),n.d(e,"initializeServiceWorkerChannel",function(){return k}),n.d(e,"requestNotificationsPermissions",function(){return _}),n.d(e,"subscribeForPNs",function(){return S}),n.d(e,"unsubscribeFromPNs",function(){return y});const m=4*s.N,v=()=>{const t=Object(o.a)()&&"1"===localStorage.getItem("notification-permission-request-closed");return"granted"===Notification.permission?a.a.Granted:"denied"===Notification.permission?a.a.Denied:t?a.a.Closed:a.a.Default},h=()=>!!Object(o.a)()&&(localStorage.removeItem("notification-permission-request-closed"),!0),j=async()=>{let t;try{t=await navigator.serviceWorker.register("/sw.js")}catch(e){return!1}return null!==await t.pushManager.getSubscription()},w=t=>{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({command:"registerClient",v2EventBoilerPlate:f.b(t)})};let O=!1;const k=async t=>{if(O)return;if(O=!0,Object(c.a)(t)!==a.f.NotificationsSupported)return;try{await navigator.serviceWorker.register("/sw.js")}catch(e){return}navigator.serviceWorker.addEventListener("message",e=>{"registerWithServiceWorker"===e.data.command&&w(t)}),w(t)},_=(t,e)=>async(n,r,s)=>{const u=r();if(await Object(i.a)())return;const d=Object(p.a)(u);if(!Object(g.E)(u)&&!d)return;if(await k(u),Object(o.a)()){const e=localStorage.getItem("push-token-last-refresh-ms"),n=(new Date).getTime();if(!t&&e&&parseInt(e)+m>n)return;localStorage.setItem("push-token-last-refresh-ms",n.toString())}f.l(u);const l=Object(c.a)(u);if(l===a.f.BrowserUnsupported)return void f.k(u,"unsupported_browser");if(l===a.f.LocalStorageUnavailable)return void f.k(u,"local_storage_unavailable");if(l===a.f.NotAllRequiredAPIsSupported)return void f.k(u,"not_all_push_apis_supported");if("denied"===Notification.permission)return n(Object(a.p)()),void f.k(u,"already_denied");if("granted"===Notification.permission)return n(Object(a.q)()),void n(S());const v=localStorage.getItem("notification-permission-request-closed");if(!e&&v&&"1"===v)return void f.k(u,"notification_permission_request_closed");const h=localStorage.getItem(a.i);if(e||!h||h!==a.j)if(e||!d||Object(b.c)(u)||(n(Object(a.s)()),!Object(p.c)(d)))switch(n(Object(a.r)()),f.j(u),await Notification.requestPermission()){case"granted":n(Object(a.q)()),n(S()),f.c(u);break;case"denied":n(Object(a.p)()),f.d(u);break;default:n(Object(a.p)()),f.e(u),localStorage.setItem("notification-permission-request-closed","1")}else f.i(r());else f.k(u,"preprompt_closed")},S=()=>async(t,e,n)=>{const i=e();try{const t=await navigator.serviceWorker.register("/sw.js");let o=await t.pushManager.getSubscription();if(!o){const e={userVisibleOnly:!0,applicationServerKey:(t=>{const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(e),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r})(r.a.pushNotificationApplicationServerKey)};o=await t.pushManager.subscribe(e)}const a=await((t,e,n)=>{const r={pushToken:JSON.stringify(n),timezoneName:Object(l.b)()||l.a,timestamp:(new Date).toISOString(),language:"en_us"};return Object(d.a)(t,Object.assign({},u,{variables:r}))})(n.gqlContext(),e(),o),c=a.body.data.registerWebPushToken;a.ok?c&&!c.ok?f.k(i,"registration_failed_in_gql"):f.m(i):f.k(i,"registration_failed_generally")}catch(s){f.k(i,"registration_failed_uncaught_exception")}},y=()=>async(t,e,n)=>{try{const t=await navigator.serviceWorker.register("/sw.js"),e=await t.pushManager.getSubscription();e&&e.unsubscribe()}catch(r){}}},"./src/reddit/actions/notifications/utils.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n("./src/lib/localStorageAvailable/index.ts"),i=n("./src/reddit/actions/notifications/constants.ts"),s=n("./src/reddit/featureFlags/index.ts");const o=t=>s.d.pushNotificationsBrowserSupported(t)?Object(r.a)()?window.Notification&&window.ServiceWorker&&window.PushManager?i.f.NotificationsSupported:i.f.NotAllRequiredAPIsSupported:i.f.LocalStorageUnavailable:i.f.BrowserUnsupported},"./src/reddit/helpers/trackers/notifications.ts":function(t,e,n){"use strict";n.d(e,"j",function(){return c}),n.d(e,"c",function(){return u}),n.d(e,"d",function(){return d}),n.d(e,"e",function(){return l}),n.d(e,"i",function(){return f}),n.d(e,"g",function(){return p}),n.d(e,"h",function(){return b}),n.d(e,"l",function(){return m}),n.d(e,"m",function(){return v}),n.d(e,"k",function(){return h}),n.d(e,"b",function(){return j}),n.d(e,"a",function(){return S}),n.d(e,"f",function(){return I});var r=n("./src/reddit/models/PushNotification/index.ts"),i=n("./src/reddit/selectors/telemetry.ts"),s=n("./src/telemetry/index.ts");const o=t=>Object.assign({},i.defaults(t),{noun:"desktop_notification_permissions"}),a=t=>Object.assign({},i.defaults(t),{noun:"desktop_notif_preprompt_permissions"}),c=t=>{Object(s.a)(Object.assign({},o(t),{action:"view",source:"popup"}))},u=t=>{Object(s.a)(Object.assign({},o(t),{action:"allow",source:"popup"}))},d=t=>{Object(s.a)(Object.assign({},o(t),{action:"block",source:"popup"}))},l=t=>{Object(s.a)(Object.assign({},o(t),{action:"close",source:"popup"}))},f=t=>{Object(s.a)(Object.assign({},a(t),{action:"view",source:"popup"}))},p=t=>{Object(s.a)(Object.assign({},a(t),{action:"allow",source:"popup"}))},b=t=>{Object(s.a)(Object.assign({},a(t),{action:"close",source:"popup"}))},g=(t,e,n)=>Object.assign({},i.defaults(t),{actionInfo:i.actionInfo(t,{success:e,reason:n}),noun:"desktop_push_token"}),m=t=>{Object(s.a)(Object.assign({},g(t,!0),{action:"request",source:"notifications"}))},v=t=>{Object(s.a)(Object.assign({},g(t,!0),{action:"register",source:"notifications"}))},h=(t,e)=>{Object(s.a)(Object.assign({},g(t,!1,e),{action:"bail",source:"notifications"}))},j=t=>Object.assign({},(t=>Object.assign({},i.defaults(t),{noun:"desktop_push_notification"}))(t),{notification:i.notification(t,void 0,void 0),action:void 0,source:"notifications",correlationId:void 0}),w=t=>(e,n)=>{Object(s.a)(Object.assign({},i.defaults(e),{action:(t=>t?"enable":"disable")(n),noun:t,source:"notifications"}))},O=w("chat_messages"),k=w("chat_requests"),_=w("comment_replies"),S=w("desktop_notification_permissions"),y=w("post_replies"),P=w("private_messages"),N=w("trending_posts"),x=w("username_mention"),I=(t,e,n)=>{switch(e){case r.a.ChatMessages:O(t,n),k(t,n);break;case r.a.TrendingPosts:N(t,n);break;case r.a.UnreadMessages:_(t,n),y(t,n),P(t,n),x(t,n)}}},"./src/reddit/models/PushNotification/index.ts":function(t,e,n){"use strict";var r;n.d(e,"a",function(){return r}),function(t){t.ChatMessages="chatMessages",t.TrendingPosts="trendingPosts",t.UnreadMessages="unreadMessages"}(r||(r={}))},"./src/reddit/selectors/experiments/dnPrePrompt.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"b",function(){return o}),n.d(e,"c",function(){return a});var r=n("./src/reddit/constants/experiments.ts"),i=n("./src/reddit/helpers/chooseVariant/index.ts");const s=t=>{const e=Object(i.b)(t,{experimentEligibilitySelector:i.a,experimentName:r.i});return Object(r.L)(e)?void 0:e},o=t=>t===r.h.DarkPrePrompt||t===r.h.DarkSystemDialogue,a=t=>t===r.h.DarkPrePrompt||t===r.h.PrePrompt}}]);
//# sourceMappingURL=PushNotifications.6dbd22ed4a4a9009cfcc.js.map

}
/*
     FILE ARCHIVED ON 18:48:43 Feb 28, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:51:52 Feb 19, 2024.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  exclusion.robots: 0.082
  exclusion.robots.policy: 0.068
  cdx.remote: 0.102
  esindex: 0.011
  LoadShardBlock: 76.937 (6)
  PetaboxLoader3.datanode: 105.815 (8)
  load_resource: 162.147 (2)
  PetaboxLoader3.resolve: 94.131 (2)
*/
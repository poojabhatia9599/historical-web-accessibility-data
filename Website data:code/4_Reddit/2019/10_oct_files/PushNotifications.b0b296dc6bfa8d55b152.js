var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

(window.webpackJsonp=window.webpackJsonp||[]).push([["PushNotifications"],{"./src/graphql/operations/RegisterWebPushToken.json":function(e){e.exports=JSON.parse('{"id":"197650c1946c"}')},"./src/lib/timezone/index.ts":function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return o})),s.d(t,"e",(function(){return a})),s.d(t,"d",(function(){return c})),s.d(t,"f",(function(){return u})),s.d(t,"g",(function(){return d})),s.d(t,"c",(function(){return l}));s("./node_modules/core-js/modules/es6.regexp.replace.js"),s("./node_modules/core-js/modules/es6.regexp.split.js");var n=s("./src/lib/constants/index.ts"),i=s("./src/reddit/models/PostCreationForm/index.ts");const r="America/Los_Angeles",o=()=>{let e;try{e=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(t){}return"Asia/Calcutta"===e&&(e="Asia/Kolkata"),e||void 0},a=e=>{const t=Math.abs(e),s=t%60,n=e>0?"-":"+",i=("0"+Math.floor(t/60)).slice(-2),r=("0"+s).slice(-2);return"".concat(n).concat(i,":").concat(r)},c=(e,t)=>{const s=t||Date.now(),i={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short",hour12:!1,timeZone:e};let r="";try{r=new Intl.DateTimeFormat("en-US",i).format(new Date(s))}catch(j){return}const[o,a,c]=r.replace(", "," ").split(" "),[u,d,l]=o.trim().split("/").map(Number),[p,m,b]=a.trim().split(":").map(Number),f=Date.UTC(l,u-1,d,p,m,b),g=new Date(s).setMilliseconds(0)-f;return{abbreviation:c,offset:Math.round(g/n.bb)}},u=e=>{const t=e.slice(0,19),[s,n]=t.split("T"),[i,r,o]=s.split("-").map(Number),[a,c,u=0]=n.split(":").map(Number);return new Date(i,r-1,o,a,c,u)},d=e=>{const t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)},l=e=>{if(e&&e.eventInfo){const{eventStart:t,eventEnd:s}=e.eventInfo;return{startDate:d(new Date(t*n.Ab)),endDate:d(new Date(s*n.Ab)),submitTime:i.i.Now,timezoneName:o()||r}}}},"./src/reddit/actions/notifications/index.ts":function(e,t,s){"use strict";s.r(t);s("./node_modules/core-js/modules/es6.regexp.to-string.js");var n=s("./src/config.ts"),i=s("./src/lib/browser/isIncognito.ts"),r=s("./src/lib/constants/index.ts"),o=s("./src/lib/localStorageAvailable/index.ts"),a=(s("./node_modules/core-js/modules/es6.regexp.replace.js"),e=>{const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),s=window.atob(t),n=new Uint8Array(s.length);for(let i=0;i<s.length;++i)n[i]=s.charCodeAt(i);return n}),c=s("./src/reddit/actions/notifications/constants.ts"),u=s("./src/reddit/actions/notifications/state.ts"),d=s("./src/reddit/actions/notifications/utils.ts"),l=s("./src/reddit/actions/toaster.ts"),p=s("./src/graphql/operations/RegisterWebPushToken.json"),m=s("./src/lib/makeGqlRequest/index.ts"),b=s("./src/lib/timezone/index.ts");var f=s("./src/reddit/helpers/trackers/notifications.ts"),g=s("./src/reddit/i18n/utils.ts"),j=s("./src/reddit/models/Toast/index.ts"),v=s("./src/reddit/selectors/experiments/dnPrePrompt.ts"),O=s("./src/reddit/selectors/notificationPrefs.ts"),h=s("./src/reddit/selectors/user.ts");s.d(t,"getBrowserNotificationPermission",(function(){return w})),s.d(t,"resetPermissionRequestClosed",(function(){return _})),s.d(t,"isBrowserSubscribedForPushNotifications",(function(){return P})),s.d(t,"initializeServiceWorkerChannel",(function(){return x})),s.d(t,"requestNotificationsPermissions",(function(){return N})),s.d(t,"subscribeForPNs",(function(){return C})),s.d(t,"unsubscribeFromPNs",(function(){return D}));const k=4*r.I,w=()=>{const e=Object(o.a)()&&"1"===localStorage.getItem("notification-permission-request-closed");return"granted"===Notification.permission?c.a.Granted:"denied"===Notification.permission?c.a.Denied:e?c.a.Closed:c.a.Default},_=()=>!!Object(o.a)()&&(localStorage.removeItem("notification-permission-request-closed"),!0),P=async()=>{let e;try{e=await navigator.serviceWorker.register("/sw.js")}catch(t){return!1}return null!==await e.pushManager.getSubscription()},S=e=>{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({command:"registerClient",v2EventBoilerPlate:f.b(e)})};let y=!1;const x=async e=>{if(y)return;if(y=!0,Object(d.a)(e)!==c.f.NotificationsSupported)return;try{await navigator.serviceWorker.register("/sw.js")}catch(t){return}navigator.serviceWorker.addEventListener("message",t=>{"registerWithServiceWorker"===t.data.command&&S(e)}),S(e)},N=(e,t)=>async(s,n,r)=>{const a=n();if(await Object(i.a)())return;const u=Object(v.a)(a);if(!Object(h.G)(a)&&!u)return;if(await x(a),Object(o.a)()){const t=localStorage.getItem("push-token-last-refresh-ms"),s=(new Date).getTime();if(!e&&t&&parseInt(t)+k>s)return;localStorage.setItem("push-token-last-refresh-ms",s.toString())}f.l(a);const l=Object(d.a)(a);if(l===c.f.BrowserUnsupported)return void f.k(a,"unsupported_browser");if(l===c.f.LocalStorageUnavailable)return void f.k(a,"local_storage_unavailable");if(l===c.f.NotAllRequiredAPIsSupported)return void f.k(a,"not_all_push_apis_supported");if("denied"===Notification.permission)return s(Object(c.p)()),void f.k(a,"already_denied");if("granted"===Notification.permission)return s(Object(c.q)()),void s(C());const p=localStorage.getItem("notification-permission-request-closed");if(!t&&p&&"1"===p)return void f.k(a,"notification_permission_request_closed");const m=localStorage.getItem(c.i);if(t||!m||m!==c.j)if(t||!u||Object(O.c)(a)||(s(Object(c.s)()),!Object(v.c)(u)))switch(s(Object(c.r)()),f.j(a),await Notification.requestPermission()){case"granted":s(Object(c.q)()),s(C()),f.c(a);break;case"denied":s(Object(c.p)()),f.d(a);break;default:s(Object(c.p)()),f.e(a),localStorage.setItem("notification-permission-request-closed","1")}else f.i(n());else f.k(a,"preprompt_closed")},C=e=>async(t,s,i)=>{const r=s();try{const o=await navigator.serviceWorker.register("/sw.js");let c=await o.pushManager.getSubscription();if(!c){const e={userVisibleOnly:!0,applicationServerKey:a(n.a.pushNotificationApplicationServerKey)};c=await o.pushManager.subscribe(e)}Object(u.c)();const d=await((e,t,s)=>{const n={pushToken:JSON.stringify(s),timezoneName:Object(b.b)()||b.a,timestamp:(new Date).toISOString(),language:"en_us"};return Object(m.a)(e,Object.assign({},p,{variables:n}))})(i.gqlContext(),s(),c),v=d.body.data.registerWebPushToken;d.ok?v&&!v.ok?f.k(r,"registration_failed_in_gql"):(f.m(r),e&&t(Object(l.e)({kind:j.b.SuccessCommunity,text:Object(g.c)("Changes saved")}))):f.k(r,"registration_failed_generally")}catch(o){f.k(r,"registration_failed_uncaught_exception"),console.error(o)}},D=e=>async(t,s,n)=>{try{const s=await navigator.serviceWorker.register("/sw.js"),n=await s.pushManager.getSubscription();n&&(n.unsubscribe(),Object(u.c)(),e&&t(Object(l.e)({kind:j.b.SuccessCommunity,text:Object(g.c)("Changes saved")})))}catch(i){}}},"./src/reddit/helpers/trackers/notifications.ts":function(e,t,s){"use strict";s.d(t,"j",(function(){return u})),s.d(t,"c",(function(){return d})),s.d(t,"d",(function(){return l})),s.d(t,"e",(function(){return p})),s.d(t,"i",(function(){return m})),s.d(t,"g",(function(){return b})),s.d(t,"h",(function(){return f})),s.d(t,"l",(function(){return j})),s.d(t,"m",(function(){return v})),s.d(t,"k",(function(){return O})),s.d(t,"b",(function(){return h})),s.d(t,"a",(function(){return y})),s.d(t,"f",(function(){return M}));var n=s("./src/reddit/models/PushNotification/index.ts"),i=s("./src/reddit/selectors/telemetry.ts"),r=s("./src/telemetry/index.ts");const o=e=>Object.assign({},i.defaults(e),{noun:"desktop_notification_permissions"}),a=e=>Object.assign({},i.defaults(e),{noun:"desktop_notif_preprompt_permissions"}),c=e=>e?"enable":"disable",u=e=>{Object(r.a)(Object.assign({},o(e),{action:"view",source:"popup"}))},d=e=>{Object(r.a)(Object.assign({},o(e),{action:"allow",source:"popup"}))},l=e=>{Object(r.a)(Object.assign({},o(e),{action:"block",source:"popup"}))},p=e=>{Object(r.a)(Object.assign({},o(e),{action:"close",source:"popup"}))},m=e=>{Object(r.a)(Object.assign({},a(e),{action:"view",source:"popup"}))},b=e=>{Object(r.a)(Object.assign({},a(e),{action:"allow",source:"popup"}))},f=e=>{Object(r.a)(Object.assign({},a(e),{action:"close",source:"popup"}))},g=(e,t,s)=>Object.assign({},i.defaults(e),{actionInfo:i.actionInfo(e,{success:t,reason:s}),noun:"push_token"}),j=e=>{Object(r.a)(Object.assign({},g(e,!0),{action:"request",source:"notification"}))},v=e=>{Object(r.a)(Object.assign({},g(e,!0),{action:"register",source:"notification"}))},O=(e,t)=>{Object(r.a)(Object.assign({},g(e,!1,t),{action:"bail",source:"notification"}))},h=e=>Object.assign({},(e=>Object.assign({},i.defaults(e),{noun:"push_notification"}))(e),{notification:i.notification(e,void 0,void 0),action:void 0,source:"notification",correlationId:void 0}),k=e=>(t,s)=>{Object(r.a)(Object.assign({},i.defaults(t),{action:c(s),noun:e,source:"notification"}))},w=k("chat_messages"),_=k("chat_requests"),P=k("comment_replies"),S=k("community_recs"),y=k("desktop_notification_permissions"),x=k("post_replies"),N=k("private_messages"),C=k("trending_posts"),D=k("username_mention"),I=k("upvotes_comment"),q=k("upvotes_post"),M=(e,t,s)=>{switch(t){case n.a.ChatMessages:w(e,s),_(e,s);break;case n.a.CommunityRecommendations:S(e,s);break;case n.a.TrendingPosts:C(e,s);break;case n.a.UpvotedComments:I(e,s);break;case n.a.UpvotedPosts:q(e,s);break;case n.a.UnreadMessages:P(e,s),x(e,s),N(e,s),D(e,s)}}},"./src/reddit/models/PushNotification/index.ts":function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){e.ChatMessages="chatMessages",e.CommunityRecommendations="communityRecommendations",e.TrendingPosts="trendingPosts",e.UnreadMessages="unreadMessages",e.UpvotedComments="upvotedComments",e.UpvotedPosts="upvotedPosts"}(n||(n={}))},"./src/reddit/selectors/experiments/dnPrePrompt.ts":function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return o})),s.d(t,"c",(function(){return a}));var n=s("./src/reddit/constants/experiments.ts"),i=s("./src/reddit/helpers/chooseVariant/index.ts");const r=e=>{const t=Object(i.b)(e,{experimentEligibilitySelector:i.a,experimentName:n.D});return Object(n.Ub)(t)?void 0:t},o=e=>e===n.C.DarkPrePrompt||e===n.C.DarkSystemDialogue,a=e=>e===n.C.DarkPrePrompt||e===n.C.PrePrompt}}]);
//# sourceMappingURL=PushNotifications.b0b296dc6bfa8d55b152.js.map

}
/*
     FILE ARCHIVED ON 04:11:05 Oct 01, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:51:56 Feb 19, 2024.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  exclusion.robots: 0.071
  exclusion.robots.policy: 0.06
  cdx.remote: 0.098
  esindex: 0.012
  LoadShardBlock: 89.873 (6)
  PetaboxLoader3.datanode: 81.718 (7)
  load_resource: 40.18
  PetaboxLoader3.resolve: 23.649
*/
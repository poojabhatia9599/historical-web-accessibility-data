"use strict";window.wafer&&window.wafer.ready((function(){window.wafer.on("fetch:success",(function(e){var t=e.elem;if(t){if(t.classList&&(t.classList.contains("collections-view-more")&&(document.documentElement.classList.remove("Reader-closed"),document.documentElement.classList.add("Reader-open"),window.wafer.base.lock(document.getElementById("MainView")),window.scrollTo(0,0)),t.classList.contains("stream-batch-fetch"))){var a=window.rapidPageConfig&&window.rapidPageConfig.rapidConfig&&window.rapidPageConfig.rapidConfig.spaceid;a&&(window._comscore=window._comscore||[],window._comscore.push({c1:2,c2:"7241469",c5:a,c7:document.location.href,c14:window.YAHOO&&window.YAHOO.comscore&&window.YAHOO.comscore.c14||-1}),window.COMSCORE&&window.COMSCORE.purge())}if(t.getAttribute("data-wf-url").indexOf("StandAloneVideo")>-1){var i="/p.gif?info=trendingvideofetch&bucket="+(window.rapidPageConfig&&window.rapidPageConfig.rapidConfig||{}).test_id;window.wafer.utils.fireBeacon(i)}}}));var e="show-drawer",t=null,a=null,i=null,n="wafer-fetch-error",r="wafer-fetch-complete",s="stream-related-drawer",o="StreamRelated",d="tdv2-wafer-stream",c="json",l="wafer-fetch",u="stream-uuid-list",w="userintent-disliked-anim",f="data-uuid",m="youmaylike",g=[],p=document.querySelector(".stream-items"),v=document.querySelector(".stream-ad-fetch"),h=window.innerWidth||document.documentElement.clientWidth,y="js-sponsored-moments-dwell-time",A="userintent-show-reason",b=window.wafer&&window.wafer.utils,L=function e(t){var a=Math.floor(16*h/9),i=t.querySelector("#defaultRESERVEMOMENTS"),n=i&&i.getAttribute("data-html");if(n){var r=window.DARLA.prefetched();if(window.DARLA.inProgress()||r&&0!==r.length)setTimeout((function(){e(t)}),500);else{var s={dest:"defaultRESERVEMOMENTS",flex:{h:{min:a},w:{min:h}},h:a,id:"RESERVEMOMENTS",supports:{"exp-ovr":1,"exp-push":1,"resize-to":1},w:h};window.DARLA.addPos(s);var o=new window.DARLA.Response("RESERVEMOMENTS",{});n=unescape(n),o.add("RESERVEMOMENTS",n),window.DARLA.render(o)}}},E={};if(p){if(p.addEventListener("animationend",(function(e){var t=e&&e.target;e&&t&&("hideStreamItem"===e.animationName||"fadeOutAdConfirm"===e.animationName)&&(t.classList.contains("ad-feedback-options")||(t.classList.contains("give-feedback-screen")&&(t=window.wafer.utils.findAncestor(t,"stream-item")),t.parentNode&&(window.wafer.base.destroy(t),t.parentNode.removeChild(t))))})),p.addEventListener("click",(function(w){var m=w.target;if(m.classList.contains("userintent-undo")){var v=m.getAttribute("data-wf-toggle-target"),h=p.querySelector(v);if(h){var y=h.getAttribute(f);y&&E[y]&&clearTimeout(E[y])}}!function(w){window.location.href.indexOf("functest=1")>-1&&w.preventDefault();var f=w.target;if(!b||!f)return;var m=b.findAncestor(f,"js-content-viewer");if(!m)return;var p=b.findAncestor(m,"stream-cluster-item")||b.findAncestor(m,"js-stream-content");if(!p)return;var v=p.getAttribute("data-uuid");if(v){var h=p&&p.getAttribute("data-parent-uuid");if(t=h&&document.querySelector('li[data-uuid="'+h+'"]')||p,i=t&&t.getElementsByClassName(s)[0]){if(t.classList.contains(e))return;var y=function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName(u)),t=0;t<e.length;t++){var a=e[t],i=a.text;a.classList.remove(u);try{var n=JSON.parse(i);n&&Array.isArray(n.uuidList)&&g.length+n.uuidList.length<=250&&(g=g.concat(n.uuidList))}catch(e){}}return{dedupUuids:g}}(),A={config:{leadItemUuid:h||v},ctrl:o,m_id:d,m_mode:c},L={dedupUuids:y.dedupUuids.join(","),uuid:v},E=i.getAttribute("data-cfg");if(E){var S=p.getAttribute("data-cposy");S=isNaN(S)?null:parseInt(S,10);try{var C=JSON.parse(E);C&&C.i13n&&(a=C.i13n),null!==S&&(C.i13n.cposy=S),A.config=Object.assign(A.config,C)}catch(e){}}var O=i.getAttribute("data-bucket");O&&(A.bucket=O),A.config.ncpParams=A.config.ncpParams||{},A.config.ncpParams.query=A.config.ncpParams.query||{},A.config.ncpParams.query=Object.assign(L,A.config.ncpParams.query);var R=window.wafer.base.state.drawer,N=R&&R.adsToken;N&&(A.config.ncpParams.query.geminiDedupeToken=N),i.setAttribute("data-wf-body",JSON.stringify(A)),i.classList.remove(n,r),i.classList.add(l),window.wafer.base.sync(i.parentNode)}}}(w)})),v&&window.wafer.base&&window.wafer.utils){var S=v.getAttribute("data-wf-url"),C=v.getAttribute("data-wf-state-body");window.wafer.utils.fetchWithCache(S,{body:C,cache:0}).then((function(e){if(e&&e.html){v.innerHTML=e.html;var t=v.querySelectorAll(".stream-ad"),a=v.getElementsByClassName("wafer-state")[0],i=p.querySelectorAll(".stream-ad-placeholder");if(t&&i)for(var n=t.length,r=i.length,s=0;s<r&&s<n;s++)i[s].replaceWith(t[s]);v.innerHTML="",a&&v.appendChild(a),window.wafer.base.sync(p)}}))}var O=p.querySelectorAll("."+y+", ."+y+"-mon");if(O.length){O.forEach((function(e){e.classList&&e.classList.contains("js-reserve-moments")&&(window.DARLA?L(e):e.style.display="none")}));var R=O[0].querySelector(".js-panorama-scroll-view");R&&0===R.scrollLeft&&(R.scrollLeft=(R.scrollWidth-h)/2);var N,M,T=document.getElementById("scrollable-smad"),q=document.getElementById("scrollable-video"),P=window.innerHeight||document.documentElement.clientHeight;if(T){var k=T.getBoundingClientRect();N=k.top-P,M=k.bottom-N}T&&q&&window.addEventListener("scroll",window.wafer.utils.throttle((function(){var e=q&&q.duration,t=T.getBoundingClientRect();t.top<P&&t.bottom>0&&(q.currentTime=(window.pageYOffset-N)*e/M)}),16))}}window.addEventListener("viewerClosed",(function(){if(t&&!t.classList.contains(e)){var n=i&&!!i.getElementsByClassName("stream-realted-list")[0];if(n){t.classList.add("drawer-beacon");var r=t;setTimeout((function(){r.classList.add(e)}),10)}n&&a&&window.rapidInstance&&window.rapidInstance.beaconClick("strm",m,0,Object.assign(a,{_p:0,cnt_tpc:a.categoryLabel,g:t.getAttribute(f),grpt:"storyCluster",itc:1,pkgt:m})),a="",i=null,t=null}}));window.wafer.on("toggle:change",(function(e){if(e&&e.meta&&e.elem){var t=e.elem,a=t.getAttribute("data-wf-toggle-target");if("userintent-hidestrmitem"===e.meta.className&&"add"===e.meta.action){if(a&&p){var i=p.querySelector(a),n=i&&i.getAttribute(f);n&&(E[n]=setTimeout((d=i,function(){d.classList.contains(w)||d.classList.add(w)}),8e3))}}else if("show-drawer"===e.meta.className){var r=p.querySelector(a),s=r&&r.getElementsByClassName("drawer-fetch-target")[0];setTimeout((function(){s&&(s.innerHTML="")}),300)}else if("userintent-show"===e.meta.className&&t){var o=window.wafer.utils.findAncestor(t,"stream-item");if(!o)return;"add"===e.meta.action?(o.classList.add(A),window.rapidInstance&&window.rapidInstance.reevaluateModulesViewability(o)):"remove"===e.meta.action&&o.classList.remove(A)}}var d}))}));
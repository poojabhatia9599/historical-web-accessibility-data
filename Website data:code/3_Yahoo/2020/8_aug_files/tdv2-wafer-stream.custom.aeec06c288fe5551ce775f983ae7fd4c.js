"use strict";window.wafer&&window.wafer.ready((function(){window.wafer.on("fetch:success",(function(e){var t=e.elem;if(t.classList&&t.classList.contains("stream-batch-fetch")){var a=window.rapidPageConfig&&window.rapidPageConfig.rapidConfig&&window.rapidPageConfig.rapidConfig.spaceid;a&&(window._comscore=window._comscore||[],window._comscore.push({c1:2,c2:"7241469",c5:a,c7:document.location.href,c14:window.YAHOO&&window.YAHOO.comscore&&window.YAHOO.comscore.c14||-1}),window.COMSCORE&&window.COMSCORE.purge())}}));var e=null,t=null,a=null,n=[],i=document.querySelector(".stream-items"),r=document.querySelector(".stream-ad-fetch"),o=window.innerWidth||document.documentElement.clientWidth,s={};function d(){this.scrollPosition=0}d.prototype.preventDefault=function(e){e.preventDefault&&e.preventDefault(),e.returnValue=!1},d.prototype.startCollectionsFullScreen=function(e){var t=this;t.preventDefault(e),setTimeout((function(){var e=document.querySelector(".collection-back-to-home");e&&(window.addEventListener("touchmove",t.preventDefault,{passive:!1}),e.addEventListener("click",t.endCollectionsFullScreen.bind(t,e)),void 0!==window.pageYOffset&&window.scrollTo&&(t.scrollPosition=window.pageYOffset,document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"))}),500)},d.prototype.endCollectionsFullScreen=function(e){document.body.style.removeProperty("overflow"),document.documentElement.style.removeProperty("overflow"),void 0!==window.pageYOffset&&window.scrollTo&&window.scrollTo(0,this.scrollPosition),e.removeEventListener("click",this.endCollectionsFullScreen),window.removeEventListener("touchmove",this.preventDefault)};var c=new d;if(i){if(i.addEventListener("animationend",(function(e){var t=e&&e.target;e&&t&&("hideStreamItem"===e.animationName||"fadeOutAdConfirm"===e.animationName)&&(t.classList.contains("ad-feedback-options")||(t.classList.contains("give-feedback-screen")&&(t=window.wafer.utils.findAncestor(t,"stream-item")),t.parentNode&&(window.wafer.base.destroy(t),t.parentNode.removeChild(t))))})),i.addEventListener("click",(function(e){var t=e.target;if(t&&t.classList.contains("view-more")&&c.startCollectionsFullScreen(e),t.classList.contains("userintent-undo")){var a=t.getAttribute("data-wf-toggle-target"),n=i.querySelector(a);if(n){var r=n.getAttribute("data-uuid");r&&s[r]&&clearTimeout(s[r])}}})),r&&window.wafer.base&&window.wafer.utils){var l=r.getAttribute("data-wf-url"),u=r.getAttribute("data-wf-state-body");window.wafer.utils.fetchWithCache(l,{body:u,cache:0}).then((function(e){if(e&&e.html){r.innerHTML=e.html;var t=r.querySelectorAll(".stream-ad"),a=i.querySelectorAll(".stream-ad-placeholder");if(t&&a)for(var n=t.length,o=a.length,s=0;s<o&&s<n;s++)a[s].replaceWith(t[s]);r.innerHTML="",window.wafer.base.sync(i)}}))}var w=i.querySelectorAll(".js-sponsored-moments-dwell-time, .js-sponsored-moments-dwell-time-mon");if(w.length){w.forEach((function(e){e.classList&&e.classList.contains("js-reserve-moments")&&(window.DARLA?function e(t){var a=Math.floor(16*o/9),n=t.querySelector("#defaultRESERVEMOMENTS"),i=n&&n.getAttribute("data-html");if(i){var r=window.DARLA.prefetched();if(window.DARLA.inProgress()||r&&0!==r.length)setTimeout((function(){e(t)}),500);else{var s={dest:"defaultRESERVEMOMENTS",flex:{h:{min:a},w:{min:o}},h:a,id:"RESERVEMOMENTS",supports:{"exp-ovr":1,"exp-push":1,"resize-to":1},w:o};window.DARLA.addPos(s);var d=new window.DARLA.Response("RESERVEMOMENTS",{});i=unescape(i),d.add("RESERVEMOMENTS",i),window.DARLA.render(d)}}}(e):e.style.display="none")}));var f=w[0].querySelector(".js-panorama-scroll-view");f&&0===f.scrollLeft&&(f.scrollLeft=(f.scrollWidth-o)/2)}}window.addEventListener("viewerOpened",(function(i){var r=i&&i.detail&&i.detail.uuid;if(r){var o=document.querySelector('li[data-uuid="'+r+'"]'),s=o&&o.getAttribute("data-parent-uuid");if(e=s&&document.querySelector('li[data-uuid="'+s+'"]')||o,a=e&&e.getElementsByClassName("stream-related-drawer")[0]){if(e.classList.contains("show-drawer"))return;var d={config:{relatedUuid:r},ctrl:"StreamRelated",m_id:"tdv2-wafer-stream",m_mode:"json"},c={dedupeUUIDs:function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName("stream-uuid-list")),t=0;t<e.length;t++){var a=e[t],i=a.text;a.classList.remove("stream-uuid-list");try{var r=JSON.parse(i);r&&Array.isArray(r.uuidList)&&n.length+r.uuidList.length<=250&&(n=n.concat(r.uuidList))}catch(e){}}return{dedupeUUIDs:n}}().dedupeUUIDs.join(","),uuid:r},l=a.getAttribute("data-cfg");if(l){var u=o.getAttribute("data-cposy");u=isNaN(u)?null:parseInt(u,10);try{var w=JSON.parse(l);w&&w.i13n&&(t=w.i13n),null!==u&&(w.i13n.cposy=u),d.config=Object.assign(d.config,w)}catch(e){}}var f=a.getAttribute("data-bucket");f&&(d.bucket=f),d.config.tachyonParams=d.config.tachyonParams||{},d.config.tachyonParams.query=d.config.tachyonParams.query||{},d.config.tachyonParams.query.where=Object.assign(c,d.config.tachyonParams.query.where);var m=window.wafer.base.state.drawer,v=m&&m.adsToken;if(v){var g={query:{where:{ads_dedup_token:v}}};d.config.adTachyonParams=Object.assign(d.config.adTachyonParams||{},g)}a.setAttribute("data-wf-body",JSON.stringify(d)),a.classList.remove("wafer-fetch-error","wafer-fetch-complete"),a.classList.add("wafer-fetch"),window.wafer.base.sync(a.parentNode)}}})),window.addEventListener("viewerClosed",(function(){if(e&&!e.classList.contains("show-drawer")){var n=a&&!!a.getElementsByClassName("stream-realted-list")[0];n&&e.classList.add("show-drawer"),n&&t&&window.rapidInstance&&window.rapidInstance.beaconClick("strm","youmaylike",0,Object.assign(t,{_p:0,cnt_tpc:t.categoryLabel,g:e.getAttribute("data-uuid"),grpt:"storyCluster",itc:1,pkgt:"youmaylike"})),t="",a=null,e=null}}));window.wafer.on("toggle:change",(function(e){if(e&&e.meta&&e.elem){var t=e.elem,a=t.getAttribute("data-wf-toggle-target");if("userintent-hidestrmitem"===e.meta.className&&"add"===e.meta.action){if(a&&i){var n=i.querySelector(a),r=n&&n.getAttribute("data-uuid");r&&(s[r]=setTimeout((l=n,function(){l.classList.contains("userintent-disliked-anim")||l.classList.add("userintent-disliked-anim")}),8e3))}}else if("show-drawer"===e.meta.className){var o=i.querySelector(a),d=o&&o.getElementsByClassName("drawer-fetch-target")[0];setTimeout((function(){d&&(d.innerHTML="")}),300)}else if("userintent-show"===e.meta.className&&t){var c=window.wafer.utils.findAncestor(t,"stream-item");if(!c)return;"add"===e.meta.action?(c.classList.add("userintent-show-reason"),window.rapidInstance&&window.rapidInstance.reevaluateModulesViewability(c)):"remove"===e.meta.action&&c.classList.remove("userintent-show-reason")}}var l}))}));
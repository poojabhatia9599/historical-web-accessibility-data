"use strict";window.wafer&&window.wafer.ready(function(){window.wafer.on("fetch:success",function(e){var t,a=e.elem;a.classList&&a.classList.contains("stream-batch-fetch")&&((t=window.rapidPageConfig&&window.rapidPageConfig.rapidConfig&&window.rapidPageConfig.rapidConfig.spaceid)&&(window._comscore=window._comscore||[],window._comscore.push({c1:2,c2:"7241469",c5:t,c7:document.location.href,c14:window.YAHOO&&window.YAHOO.comscore&&window.YAHOO.comscore.c14||-1}),window.COMSCORE&&window.COMSCORE.purge()))});var e,t,a,n,u="show-drawer",w=null,m=null,f=null,g="stream-uuid-list",c="userintent-disliked-anim",l="data-uuid",r="youmaylike",h=[],y=document.querySelector(".stream-items"),s=document.querySelector(".stream-ad-fetch"),d=window.innerWidth||document.documentElement.clientWidth,i="js-sponsored-moments-dwell-time",p="userintent-show-reason",v={};y&&(y.addEventListener("animationend",function(e){var t=e&&e.target;e&&t&&("hideStreamItem"===e.animationName||"fadeOutAdConfirm"===e.animationName)&&t.parentNode&&!t.classList.contains("ad-feedback-options")&&(window.wafer.base.destroy(t),t.parentNode.removeChild(t))}),y.addEventListener("click",function(e){var t,a,n,r=e.target;r.classList.contains("userintent-undo")&&(t=r.getAttribute("data-wf-toggle-target"),!(a=y.querySelector(t))||(n=a.getAttribute(l))&&v[n]&&clearTimeout(v[n]))}),s&&window.wafer.base&&window.wafer.utils&&(e=s.getAttribute("data-wf-url"),t=s.getAttribute("data-wf-state-body"),window.wafer.utils.fetchWithCache(e,{body:t,cache:0}).then(function(e){if(e&&e.html){s.innerHTML=e.html;var t=s.querySelectorAll(".stream-ad"),a=y.querySelectorAll(".stream-ad-placeholder");if(t&&a)for(var n=t.length,r=a.length,i=0;i<r&&i<n;i++)a[i].replaceWith(t[i]);s.innerHTML="",window.wafer.base.sync(y)}})),(a=y.querySelectorAll("."+i+", ."+i+"-mon")).length&&(a.forEach(function(e){e.classList&&e.classList.contains("js-reserve-moments")&&(window.DARLA?function e(t){var a,n,r,i=Math.floor(16*d/9),s=t.querySelector("#defaultRESERVEMOMENTS"),o=s&&s.getAttribute("data-html");o&&(a=window.DARLA.prefetched(),window.DARLA.inProgress()||a&&0!==a.length?setTimeout(function(){e(t)},500):(n={dest:"defaultRESERVEMOMENTS",flex:{h:{min:i},w:{min:d}},h:i,id:"RESERVEMOMENTS",supports:{"exp-ovr":1,"exp-push":1,"resize-to":1},w:d},window.DARLA.addPos(n),r=new window.DARLA.Response("RESERVEMOMENTS",{}),o=unescape(o),r.add("RESERVEMOMENTS",o),window.DARLA.render(r)))}(e):e.style.display="none")}),(n=a[0].querySelector(".js-panorama-scroll-view"))&&0===n.scrollLeft&&(n.scrollLeft=(n.scrollWidth-d)/2)));window.addEventListener("viewerOpened",function(e){var t=e&&e.detail&&e.detail.uuid;if(t){var a=document.querySelector('li[data-uuid="'+t+'"]'),n=a&&a.getAttribute("data-parent-uuid");if(w=n&&document.querySelector('li[data-uuid="'+n+'"]')||a,f=w&&w.getElementsByClassName("stream-related-drawer")[0]){if(w.classList.contains(u))return;var r={config:{relatedUuid:t},ctrl:"StreamRelated",m_id:"tdv2-wafer-stream",m_mode:"json"},i={dedupeUUIDs:function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName(g)),t=0;t<e.length;t++){var a=e[t],n=a.text;a.classList.remove(g);try{var r=JSON.parse(n);r&&Array.isArray(r.uuidList)&&h.length+r.uuidList.length<=250&&(h=h.concat(r.uuidList))}catch(e){}}return{dedupeUUIDs:h}}().dedupeUUIDs.join(","),uuid:t},s=f.getAttribute("data-cfg");if(s)try{var o=JSON.parse(s);o&&o.i13n&&(m=o.i13n),r.config=Object.assign(r.config,o)}catch(e){}r.config.tachyonParams=r.config.tachyonParams||{},r.config.tachyonParams.query=r.config.tachyonParams.query||{},r.config.tachyonParams.query.where=Object.assign(i,r.config.tachyonParams.query.where);var d,c=window.wafer.base.state.drawer,l=c&&c.adsToken;l&&(d={query:{where:{ads_dedup_token:l}}},r.config.adTachyonParams=Object.assign(r.config.adTachyonParams||{},d)),f.setAttribute("data-wf-body",JSON.stringify(r)),f.classList.remove("wafer-fetch-error","wafer-fetch-complete"),f.classList.add("wafer-fetch"),window.wafer.base.sync(f.parentNode)}}}),window.addEventListener("viewerClosed",function(){var e;w&&!w.classList.contains(u)&&((e=f&&!!f.getElementsByClassName("stream-realted-list")[0])&&w.classList.add(u),e&&m&&window.rapidInstance&&window.rapidInstance.beaconClick("strm",r,0,Object.assign(m,{_p:0,cnt_tpc:m.categoryLabel,g:w.getAttribute(l),grpt:"storyCluster",itc:1,pkgt:r})),m="",w=f=null)});window.wafer.on("toggle:change",function(e){if(e&&e.meta&&e.elem){var t,a,n=e.elem,r=n.getAttribute("data-wf-toggle-target");if("userintent-hidestrmitem"===e.meta.className&&"add"===e.meta.action)r&&y&&((a=(t=y.querySelector(r))&&t.getAttribute(l))&&(v[a]=setTimeout((d=t,function(){d.classList.contains(c)||d.classList.add(c)}),8e3)));else if("show-drawer"===e.meta.className){var i=y.querySelector(r),s=i&&i.getElementsByClassName("drawer-fetch-target")[0];setTimeout(function(){s&&(s.innerHTML="")},300)}else if("userintent-show"===e.meta.className&&n){var o=window.wafer.utils.findAncestor(n,"stream-item");if(!o)return;"add"===e.meta.action?o.classList.add(p):"remove"===e.meta.action&&o.classList.remove(p)}}var d})});
"use strict";window.wafer&&window.wafer.ready((function(){window.wafer.on("fetch:success",(function(e){var t=e.elem;if(t&&t.classList&&(t.classList.contains("collections-view-more")&&(document.documentElement.classList.remove("Reader-closed"),document.documentElement.classList.add("Reader-open"),window.wafer.base.lock(document.getElementById("MainView")),window.scrollTo(0,0)),t.classList.contains("stream-batch-fetch"))){var a=window.rapidPageConfig&&window.rapidPageConfig.rapidConfig&&window.rapidPageConfig.rapidConfig.spaceid;a&&(window._comscore=window._comscore||[],window._comscore.push({c1:2,c2:"7241469",c5:a,c7:document.location.href,c14:window.YAHOO&&window.YAHOO.comscore&&window.YAHOO.comscore.c14||-1}),window.COMSCORE&&window.COMSCORE.purge())}}));var e="show-drawer",t=null,a=null,i=null,n="stream-uuid-list",r="userintent-disliked-anim",s="data-uuid",o="youmaylike",d=[],c=document.querySelector(".stream-items"),l=document.querySelector(".stream-ad-fetch"),w=window.innerWidth||document.documentElement.clientWidth,u="js-sponsored-moments-dwell-time",m="userintent-show-reason",f={};if(c){if(c.addEventListener("animationend",(function(e){var t=e&&e.target;e&&t&&("hideStreamItem"===e.animationName||"fadeOutAdConfirm"===e.animationName)&&(t.classList.contains("ad-feedback-options")||(t.classList.contains("give-feedback-screen")&&(t=window.wafer.utils.findAncestor(t,"stream-item")),t.parentNode&&(window.wafer.base.destroy(t),t.parentNode.removeChild(t))))})),c.addEventListener("click",(function(e){var t=e.target;if(t.classList.contains("userintent-undo")){var a=t.getAttribute("data-wf-toggle-target"),i=c.querySelector(a);if(i){var n=i.getAttribute(s);n&&f[n]&&clearTimeout(f[n])}}})),l&&window.wafer.base&&window.wafer.utils){var g=l.getAttribute("data-wf-url"),h=l.getAttribute("data-wf-state-body");window.wafer.utils.fetchWithCache(g,{body:h,cache:0}).then((function(e){if(e&&e.html){l.innerHTML=e.html;var t=l.querySelectorAll(".stream-ad"),a=l.getElementsByClassName("wafer-state")[0],i=c.querySelectorAll(".stream-ad-placeholder");if(t&&i)for(var n=t.length,r=i.length,s=0;s<r&&s<n;s++)i[s].replaceWith(t[s]);l.innerHTML="",a&&l.appendChild(a),window.wafer.base.sync(c)}}))}var y=c.querySelectorAll("."+u+", ."+u+"-mon");if(y.length){y.forEach((function(e){e.classList&&e.classList.contains("js-reserve-moments")&&(window.DARLA?function e(t){var a=Math.floor(16*w/9),i=t.querySelector("#defaultRESERVEMOMENTS"),n=i&&i.getAttribute("data-html");if(n){var r=window.DARLA.prefetched();if(window.DARLA.inProgress()||r&&0!==r.length)setTimeout((function(){e(t)}),500);else{var s={dest:"defaultRESERVEMOMENTS",flex:{h:{min:a},w:{min:w}},h:a,id:"RESERVEMOMENTS",supports:{"exp-ovr":1,"exp-push":1,"resize-to":1},w:w};window.DARLA.addPos(s);var o=new window.DARLA.Response("RESERVEMOMENTS",{});n=unescape(n),o.add("RESERVEMOMENTS",n),window.DARLA.render(o)}}}(e):e.style.display="none")}));var v=y[0].querySelector(".js-panorama-scroll-view");v&&0===v.scrollLeft&&(v.scrollLeft=(v.scrollWidth-w)/2)}}window.addEventListener("viewerOpened",(function(r){var s=r&&r.detail&&r.detail.uuid;if(s){var o=document.querySelector('li[data-uuid="'+s+'"]'),c=o&&o.getAttribute("data-parent-uuid");if(t=c&&document.querySelector('li[data-uuid="'+c+'"]')||o,i=t&&t.getElementsByClassName("stream-related-drawer")[0]){if(t.classList.contains(e))return;var l={config:{relatedUuid:s},ctrl:"StreamRelated",m_id:"tdv2-wafer-stream",m_mode:"json"},w={dedupeUUIDs:function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName(n)),t=0;t<e.length;t++){var a=e[t],i=a.text;a.classList.remove(n);try{var r=JSON.parse(i);r&&Array.isArray(r.uuidList)&&d.length+r.uuidList.length<=250&&(d=d.concat(r.uuidList))}catch(e){}}return{dedupeUUIDs:d}}().dedupeUUIDs.join(","),uuid:s},u=i.getAttribute("data-cfg");if(u){var m=o.getAttribute("data-cposy");m=isNaN(m)?null:parseInt(m,10);try{var f=JSON.parse(u);f&&f.i13n&&(a=f.i13n),null!==m&&(f.i13n.cposy=m),l.config=Object.assign(l.config,f)}catch(e){}}var g=i.getAttribute("data-bucket");g&&(l.bucket=g),l.config.tachyonParams=l.config.tachyonParams||{},l.config.tachyonParams.query=l.config.tachyonParams.query||{},l.config.tachyonParams.query.where=Object.assign(w,l.config.tachyonParams.query.where);var h=window.wafer.base.state.drawer,y=h&&h.adsToken;if(y){var v={query:{where:{ads_dedup_token:y}}};l.config.adTachyonParams=Object.assign(l.config.adTachyonParams||{},v)}i.setAttribute("data-wf-body",JSON.stringify(l)),i.classList.remove("wafer-fetch-error","wafer-fetch-complete"),i.classList.add("wafer-fetch"),window.wafer.base.sync(i.parentNode)}}})),window.addEventListener("viewerClosed",(function(){if(t&&!t.classList.contains(e)){var n=i&&!!i.getElementsByClassName("stream-realted-list")[0];n&&t.classList.add(e),n&&a&&window.rapidInstance&&window.rapidInstance.beaconClick("strm",o,0,Object.assign(a,{_p:0,cnt_tpc:a.categoryLabel,g:t.getAttribute(s),grpt:"storyCluster",itc:1,pkgt:o})),a="",i=null,t=null}}));window.wafer.on("toggle:change",(function(e){if(e&&e.meta&&e.elem){var t=e.elem,a=t.getAttribute("data-wf-toggle-target");if("userintent-hidestrmitem"===e.meta.className&&"add"===e.meta.action){if(a&&c){var i=c.querySelector(a),n=i&&i.getAttribute(s);n&&(f[n]=setTimeout((w=i,function(){w.classList.contains(r)||w.classList.add(r)}),8e3))}}else if("show-drawer"===e.meta.className){var o=c.querySelector(a),d=o&&o.getElementsByClassName("drawer-fetch-target")[0];setTimeout((function(){d&&(d.innerHTML="")}),300)}else if("userintent-show"===e.meta.className&&t){var l=window.wafer.utils.findAncestor(t,"stream-item");if(!l)return;"add"===e.meta.action?(l.classList.add(m),window.rapidInstance&&window.rapidInstance.reevaluateModulesViewability(l)):"remove"===e.meta.action&&l.classList.remove(m)}}var w}))}));
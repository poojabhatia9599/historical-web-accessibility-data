YUI.add("type_sda",function(a){a.namespace("My.Extensions.Sda");var b="#my-adsLREC2-config",o="#my-adsLREC2",d="#sticky-lrec2-footer",e="fetch_selective_ad",f=window.DARLA||null,l="LREC2",g="LREC4",h="MON2",c=false,i="hlAdsAll",k="",n="2023538075",j=100;function m(){var p=this;YMedia.after("appletsinit",function(q){p.init();});}m.prototype.init=function(){var r=this;var q=a.one(b);if(!q){return;}var u=q.getData("config");if(!u){return;}try{lrec2PositionMeta=a.JSON.parse(u);}catch(t){return;}o="#my-ads"+lrec2PositionMeta.pos;this.container=a.one(o);this.streamRestoreState=false;if(!this.container||!f){return;}var s=a.one("body");var v=s&&!!s.one("#bbnavdetect");s.plug(a.Plugin.ScrollInfo);this.scrollInfo=s.scrollInfo;this.scrollevent=this.scrollInfo.on("scroll",a.bind(this.VisibleLREC2Ads,this,true),this);if(v){a.Global.on("stream:normal-load",function(){r.addAutoEvent();r.registerTabswitch();r.registerScrollRotate();r.VisibleLREC2Ads();r.fetchDarlaAd(false,true);});a.Global.on("stream:restore-state",function(){if(r.isNodeInViewport(o)){var w=true;r.fetchDarlaAd(w);}},r);}else{setTimeout(function(){r.addAutoEvent();r.registerTabswitch();r.registerScrollRotate();r.VisibleLREC2Ads();r.fetchDarlaAd(false,true);},300);}var p=q.getData("offset");j=p&&parseInt(p,10)||j;};m.prototype.isNodeInViewport=function(p){var q=this.scrollInfo.getOnscreenNodes(p,j);if(a.one("html").hasClass("Reader-open")&&!a.one("html").hasClass("Reader-closed")){return false;}return !q.isEmpty();},m.prototype.VisibleLREC2Ads=function(){if(this.isNodeInViewport(o)){this.fetchDarlaAd();if(this.scrollevent){this.scrollevent.detach();this.scrollevent=null;}}};m.prototype.registerTabswitch=function(){var x=this;var s=a.one(b);var r=s.getData("tabswitchrotate");var z=s.getData("adBoostGroupRotation")||"";r=r&&parseInt(r,10)||0;var t=r>0;if(!t){return;}var y=Date.now||function(){return new Date().getTime();};var w=y();var u=a.Af&&a.Af.PageViz&&a.Af.PageViz.isHidden()||false;var v;function p(){if(!u){w=y();u=true;}}if(z){v=a.JSON.parse(z);}function q(){if(window.disableAdboost){return;}var B=y();if(B-w<r){return;}if(a.Af&&a.Af.PageViz&&a.Af.PageViz.isHidden()){u=true;return;}u=false;if(!window._darlaAutoEvt){window._darlaAutoEvt=x.getAutoEvent();}var D=[].concat(a.Object.keys(window._darlaAutoEvt.ps),"MON");var A=[];if(!window.DARLA||window.DARLA.inProgress()){return;}a.Array.each(D,function(F){if(A.indexOf(F)<0){var G=window.DARLA.posSettings(F);if(G){if(x.isNodeInViewport("#"+G.dest)){var E=a.one("#"+G.dest);if(E&&E.get("offsetHeight")>1){A.push(F);if(v&&v[F]){if(v[F].inview){var H=true;a.Array.each([].concat(v[F].inview),function(J){var I=window.DARLA.posSettings(J);if(I){if(!x.isNodeInViewport("#"+I.dest)){H=false;}}});if(H){a.Array.each([].concat(v[F].inview,v[F].extrapositions),function(I){if(A.indexOf(I)<0){A.push(I);}});}}else{a.Array.each([].concat(v[F].extrapositions),function(I){if(A.indexOf(I)<0){A.push(I);}});}}}}}}});if(A.length>0){var C={ps:A.join(","),name:"tabswitch",sp:window._darlaAutoEvt.sp,sa:window._darlaAutoEvt.sa+" "+(window.customSiteAttr||""),ssl:window._darlaAutoEvt.ssl,secure:window._darlaAutoEvt.secure,ref:window.location.href,npv:1,property:"fp",ult:window._darlaAutoEvt.ult,experience:window._darlaAutoEvt.experience};window.DARLA.add(C);window.DARLA.event("tabswitch");}}a.on("blur",p,window);a.on("focus",q,window);if(a.Af&&a.Af.PageViz){a.Af.PageViz.on("visible",q,x);a.Af.PageViz.on("hidden",p,x);}},m.prototype.registerScrollRotate=function(){var r=this;var q=a.one(b);var w=q.getData("scrollrotate");var t=q.getData("lrec2SelectiveEnabled")==="1",w=w&&parseInt(w,10)||0;var s=w>0;if(!s){return;}var p=0;var u=0;function v(){p++;if(p-u<w){return;}if(!window._darlaAutoEvt){window._darlaAutoEvt=r.getAutoEvent();}var y=t?["LREC3","LREC4","MON2"]:[];var A=[].concat(a.Object.keys(window._darlaAutoEvt.ps),["MON"],y);var x=[];if(!window.DARLA||window.DARLA.inProgress()){return;}a.Array.each(A,function(C){if(x.indexOf(C)<0){var D=window.DARLA.posSettings(C);if(D){if(r.isNodeInViewport("#"+D.dest)){var B=a.one("#"+D.dest);if(B&&B.get("offsetHeight")>1){x.push(C);}}}}});if(x.length>0){u=p;var z={ps:x.join(","),name:"scrollrotate",sp:window._darlaAutoEvt.sp,sa:window._darlaAutoEvt.sa+" "+(window.customSiteAttr||""),ssl:window._darlaAutoEvt.ssl,secure:window._darlaAutoEvt.secure,ref:window.location.href,npv:1,property:"fp",ult:window._darlaAutoEvt.ult,experience:window._darlaAutoEvt.experience};window.DARLA.add(z);window.DARLA.event("scrollrotate");}}window.sdaAvpCallback=v;},m.prototype.addAutoEvent=function(){var q=this;var p=a.one(b);var r=p.getData("autorotate")==="1";if(!r){return;}if(window.DARLA&&window.DARLA.inProgress()){setTimeout(function(){q.addAutoEvent();},500);}else{window._darlaAutoEvt=q.getAutoEvent();if(window.DARLA&&window._darlaAutoEvt){window.DARLA.add(window._darlaAutoEvt);}}},m.prototype.getAutoEvent=function(){var p={pg:{property:"fp",test:window.Af.context.bucket,intl:window.Af.context.region,rid:window.Af.context.rid,device:window.Af.context.device}},t='Y-BUCKET="'+window.Af.context.bucket+'"',C=(window.location.protocol==="http:")?0:1,z=a.one(b),J=z.getData("disablerotation")==="1",v=z.getData("lrec4enabled")==="1",D=z.getData("mon2Enabled")==="1",E=z.getData("autoeventrt"),r=z.getData("mastrt"),F=z.getData("lrecrt"),u=z.getData("ldrbrt"),I=z.getData("defaultrt"),B=z.getData("currentpos"),G={},x=z.getData("lrec2SelectiveEnabled")==="1",q=z.getData("groupRotation")||"",s,A="",y=n;if(window.facCustomTimout&&window.facCustomTimout>0){t+=" ctout="+window.facCustomTimout;}if(window.flSAKey&&"undefined"!==window.flInstalled){t+=" "+window.flSAKey+"="+window.flInstalled;}if(window.segBlob){var H="";var K="";for(var w in window.segBlob){if(window.segBlob.hasOwnProperty(w)){H+=K+w+":"+window.segBlob[w];K=";";}}t+=' rs="'+H+'"';}if(window.YAHOO&&window.YAHOO.i13n){A=window.YAHOO.i13n.currentSID||"";y=window.YAHOO.i13n.SPACEID||n;}if(!J){G[B]={autoIV:1,autoMax:25,autoRT:I};if(v){G.LREC4={autoIV:1,autoMax:25,autoRT:I};}if(D){G.MON2={autoIV:1,autoMax:25,autoRT:I};}}if(r&&a.Array.indexOf(window.pageloadNonCollapsedAds||[],"MAST")>=0){G.MAST={autoIV:1,autoMax:25,autoRT:r};}if(u&&a.Array.indexOf(window.pageloadNonCollapsedAds||[],"LDRB")>=0){G.LDRB={autoIV:1,autoMax:25,autoRT:u};}if(F&&a.Array.indexOf(window.pageloadNonCollapsedAds||[],"LREC")>=0){G.LREC={autoIV:1,autoMax:25,autoRT:F};}s={ps:G,name:"AUTO",sp:y,autoStart:1,autoMax:25,autoRT:E,autoIV:1,autoDDG:1,ssl:C,secure:1,ref:window.location.href,npv:1,property:"fp",ult:p,experience:{pt:"index",pd:"modal",rid:window.Af.context.rid,sid:A,bucket:window.Af.context.bucket}};if(q){s.groups=a.JSON.parse(q);}if(bucketSAEnabled){s.sa=t;}return s;},m.prototype.fetchAdLater=function(s){var r=this;var p=0;var q=setInterval(function(){if(p>20){clearInterval(q);return;}if(f.inProgress()&&window.performance&&window.performance.now&&window.performance.now()>=10000){f.abort();}if(!f.inProgress()){clearInterval(q);r.fetchDarlaAd(s);}p++;},500);},m.prototype.fetchDarlaAd=function(P,D){var Q,q,r,H=this,J,N=false,x=false,G=a.one(b),M=G.getData("config"),u=G.getData("lrec4pos")||"LREC4",F=G.getData("mon2pos")||"MON2",A=a.one("#my-ads"+u)&&a.one("#my-ads"+u).getData("config"),B=a.one("#my-ads"+F)&&a.one("#my-ads"+F).getData("config"),I={pos:"LREC2",clean:"my-adsLREC2",dest:"my-adsLREC2-iframe",metaSize:true,w:300,h:250,supports:false},R={pos:u,clean:"my-ads"+u,dest:"my-ads"+u+"-iframe",metaSize:true,w:300,h:250,supports:false},C={pos:F,clean:"my-ads"+F,dest:"my-ads"+F+"-iframe",metaSize:true,w:300,h:600,supports:false},p={pg:{property:"fp",test:window.Af.context.bucket,intl:window.Af.context.region,rid:window.Af.context.rid,device:window.Af.context.device}},t='Y-BUCKET="'+window.Af.context.bucket+'"',L=(window.location.protocol==="http:")?0:1,w=a.one(b).getData("lrec2SelectiveEnabled")==="1",K="",E=n;if(window.facCustomTimout&&window.facCustomTimout>0){t+=" ctout="+window.facCustomTimout;}if(window.flSAKey&&"undefined"!==window.flInstalled){t+=" "+window.flSAKey+"="+window.flInstalled;}if(window.segBlob){var O="";var S="";for(var z in window.segBlob){if(window.segBlob.hasOwnProperty(z)){O+=S+z+":"+window.segBlob[z];S=";";}}t+=' rs="'+O+'"';}if(window.YAHOO&&window.YAHOO.i13n){K=window.YAHOO.i13n.currentSID||"";E=window.YAHOO.i13n.SPACEID||n;}if(M){I=a.JSON.parse(M);l=I.pos;}if(A){R=a.JSON.parse(A);g=R.pos;}if(B){C=a.JSON.parse(B);h=C.pos;}I.id=l;N=G.getData("autorotate")==="1";q=e+"_"+l.toLowerCase();x=G.getData("lrec4enabled")==="1";mon2Enabled=G.getData("mon2enabled")==="1";J=l;if(x){J=J+","+g;}if(mon2Enabled){J=J+","+h;}Q={ps:J,name:q,sp:E,ssl:L,secure:1,ref:window.location.href,npv:1,property:"fp",ult:p,experience:{pt:"index",pd:"modal",rid:window.Af.context.rid,sid:K,bucket:window.Af.context.bucket}};if(bucketSAEnabled){Q.sa=t;}var y=x?[R,I]:[I];if(mon2Enabled){y.push(C);}if(!D){if(f.inProgress()){var v=f.inProgress();if(v&&v===i){H.detachScroll=true;f.abort();f.add(Q);f.addPos(y);f.event(q);}else{this.fetchAdLater(P);return;}}else{if(w){H.detachScroll=true;f.add(Q);f.addPos([y]);f.event(q);}}}r=H.getAutoEvent();if(N){f.add(r);}if(!f.isAutoOn()){f.startAuto();}var s=function(){if(f.inProgress()){var T=f.inProgress();if(T&&T===i){f.abort();}else{return;}}c=true;if(H.detachScroll&&H.scrollevent){H.scrollevent.detach();H.scrollevent=null;}if(N){f.add(r);if(!f.isAutoOn()){f.startAuto();}}k="";if(H.isNodeInViewport(d)){k=l;if(mon2Enabled){k=k+","+h;}if(x){k=k+","+g;}}if(k){H.detachScroll=true;Q.ps=k;f.add(Q);f.event(q);}};a.Af.Event.on("modal:hide",s);};m.prototype.destructor=function(){};a.My.Extensions.Sda.init=new m();},"0.0.1",{requires:["node-scroll-info","json-parse"]});/* Copyright (c) 2019, Yahoo! Inc.  All rights reserved. */

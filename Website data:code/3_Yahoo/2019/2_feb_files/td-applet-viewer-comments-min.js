YUI.add("td-applet-viewer-comments",function(e){"use strict";var n="BODY",t="canvass-modal-open",o=document,s=".viewer-content-body",a=window;e.namespace("TD.Viewer").Comments=function(n,t,o){var s=this;s.config=n,s.container=e.one(t),s.handles=[],YAHOO&&YAHOO.CanvassComments?s.initialize(o):e.Get.js(s.config.js,function(){s.initialize(o)})},e.TD.Viewer.Comments.prototype={initialize:function(n){var t=this,o=t.config,s=t.container,a="canvass-"+o.uuid,i="yahoo_content"===o.commentsNamespace,c=e.Object.getValue(window.rapidPageConfig,["rapidConfig","keys"],{});if(!s||!YAHOO.CanvassComments)return console.warn("Cannot create CanvassComments"),void(n&&n());t.handles.push(e.on("td-applet-canvass:open",function(e){e.contextUuid===t.config.uuid&&(t.expanded=!0,t.expand())})),t.handles.push(e.on("td-applet-canvass:destroy",function(e){var n=e&&e.guid;n&&n==="canvass-"+t.config.uuid&&t.destroy()})),t.handles.push(e.Af.Event.on("modal:hide",function(){t.destroy()})),s.setHTML('<div id="'+a+'" class="td-applet-canvass" data-applet-guid="'+a+'"></div>'),t.canvass=new YAHOO.CanvassComments(a,{bucket:o.bucket,context:o.uuid,contextDisplayText:o.title,contextUrl:o.url,device:o.device,expanded:o.autoShow,namespace:o.commentsNamespace,lang:o.lang,onCollapsed:t._restoreScrollPos.bind(t),onExpanded:t._saveScrollPos.bind(t),onInitialized:t.onCanvassInitialized.bind(t),prid:o.prid,rapid:o.rapid,rapidKeys:{_rid:o.prid,hosted:i?"true":"",mrkt:c.mrkt||"us",navtype:"client",p_hosted:i?"onnet":"offnet",pd:"modal",pt:"content",pct:o.type||"story",pstaid:o.uuid,site:c.site||"fp",ver:c.ver||""},region:o.region,site:c.site||"fp",spaceid:o.spaceid}),o.autoShow&&t.canvass.expand(),n&&n()},destroy:function(){var n=this;n.canvass&&(n.canvass.destroy(),n.canvass=null,e.Array.each(n.handles,function(e){e.detach()}),n.handles=[],n._restoreScrollPos()),n.container&&(n.container.set("text",""),n.container=null)},expand:function(){this.canvass&&this.canvass.expand()},onCanvassInitialized:function(n){this.expanded&&this.expand(),e.fire("td-applet-canvass:loaded",{commentCount:n.count||0,contextUuid:this.config.uuid})},_saveScrollPos:function(){var i,c=this;"smartphone"===c.config.device&&(e.one(n).addClass(t),!(i=e.one(s))||i.ancestor(".vv-item")||c._scrollTop||(c._scrollTop=o.documentElement&&o.documentElement.scrollTop||o.body.scrollTop||0,i.setStyle("transform","translateY(-"+c._scrollTop+"px)"),a.scrollTo(0,0)))},_restoreScrollPos:function(){var o,i=this;"smartphone"===i.config.device&&(e.one(n).removeClass(t),(o=e.one(s))&&i._scrollTop&&(o.setStyle("transform",null),a.scrollTo(0,i._scrollTop)))}}},"@VERSION@",{requires:["af-event","get"]});
YUI.add("td-viewer-ads",function(e,t){"use strict";var n=e.config.win,a="ads-story",i=e.Af.Event,o=".js-ad-dislike-button",s="js-viewer-adfdb-options",d=e.UA.android||e.UA.ie?"click":"tap",r=["LREC2-4","LREC2-5","LREC2-6","LREC2-7","LREC2-8","LREC3-4","LREC3-5","LREC3-6","LREC3-7","LREC3-8"];function l(e){var t=this;t.model=e.model,t.i18n=e.i18n,t.context=e.context,t.template=e.template,t.displayAdsConfig=e.config.displayAds,t.enableAdsFeedback=e.config.enableAdsFeedback,t.forceSpaceid=t.displayAdsConfig.forced_modalspaceid,t.displayAdsFPConfig=e.config.displayAdsFP,t.smad=e.config.smad,t.guid=e.guid,t.curveballConfig=e.config.curveball,t.parent=e.view,t.displayAdsObj=null,t.drawer=null,t.scrollTimer=-1,t.init(),t.commentsLREC=e.commentsLREC||!1,t.allowHostUrlAsReferrer=e.config.allowHostUrlAsReferrer||!1,t.displayAdsConfig.enableAdLayout&&(t.adResponseFlushTimer=null)}l.prototype={init:function(){var t=this;t.unbeaconedAds=[],t.unbeaconedPrtAds=[],t.unbeaconedGnvAds=[],t.displayAdsFPConfig.enabled&&e.Global.on("hlads:fp",function(e){t.fetchFPAds(e.spaceid)}),(t.curveballConfig.enabled||t.curveballConfig.enableBeaconListenerOnly)&&(i.on("curveball:append",function(n){t.unbeaconedAds=t.unbeaconedAds.concat(n.ads||[]),e.Array.each(n.ads||[],function(e){e.getAttribute("data-prtbc")&&(t.unbeaconedPrtAds=t.unbeaconedPrtAds.concat(e))}),t.curveballConfig.genericViewability&&(t.unbeaconedGnvAds=t.unbeaconedGnvAds.concat(e.Array.map(n.ads||[],function(t){var n=t.getAttribute("data-vwrules");try{n=e.JSON.parse(n)}catch(a){}return{node:t,rules:n}})))}),t.curveballConfig.enableVisibilityRect?n.addEventListener("scroll",t.handleScroll.bind(t),!1):n.addEventListener("scroll",t.beaconVisibleAds.bind(t),!1)),i.on("sidekick:load",t.onSidekickLoad.bind(t),!1),t.displayAdsConfig.monSponsorship&&(t.hlViewerNode=e.one("#hl-viewer"),i.on("sidekickrefresh",t.onDisplayAdCallResp.bind(t),!1))},updatePageIndex:function(e,t){var n,a;for(t=t||0,n=0,a=e.length;n<a;n++)e[n].pageIndex=t+n,e[n].reverseZindex=10-n},onSidekickLoad:function(e){var t=this,n=DARLA.prefetched();n&&0!==n.length?t.renderSidekickDisplayAds(e):setTimeout(function(){t.renderSidekickDisplayAds(e)},500)},renderSidekickDisplayAds:function(e){var t,n,a,i,o,s=this,d=DARLA.prefetched(),r=[],l=[];if(d.length>0)for(i=0;i<d.length;i++){for(t=!1,o=0;o<e.positions.length;o++)if(e.positions[o]+"-0"===d[i]){t=!0;break}t||!d[i].match(/LREC/)?r.push(d[i]):l.push(d[i])}for(i=0;i<l.length;i++)a=DARLA.posSettings(l[i]),(n=document.getElementById(a.clean)||document.getElementById(a.clean+"-notused"))&&(n.id.match(/-notused/)||(n.id+="-notused"),n.parentElement.className=n.parentElement.className.replace("lrec-before-loading",""),n.className=n.className.replace("lrec-reserve-ht","")),(n=document.getElementById(a.dest)||document.getElementById(a.dest+"-notused"))&&(n.id.match(/-notused/)||(n.id+="-notused",n.className+=" D-n"));DARLA.render(r),this.adResponseFlushTimer&&(clearTimeout(this.adResponseFlushTimer),this.adResponseFlushTimer=null),this.adResponseFlushTimer=setTimeout(function(){DARLA.render(),s.adResponseFlushTimer=null},1500)},insertAds:function(e,t,n,a,i,o){var s,d=this;d.insertDisplayAds(e,t,a,i,o),s=d.insertCurveball(n),d.unbeaconedAds=d.unbeaconedAds.concat(s||[]),d.unbeaconedAds.length>0&&setTimeout(function(){d.curveballConfig.enableVisibilityRect?d.beaconVisibleAds(!0):d.beaconVisibleAds()},300)},insertGeminiAdsOnly:function(e,t){var n,a=this;n=a.insertCurveball(e,t),a.unbeaconedAds=a.unbeaconedAds.concat(n||[]),a.unbeaconedAds.length>0&&setTimeout(function(){a.curveballConfig.enableVisibilityRect?a.beaconVisibleAds(!0):a.beaconVisibleAds()},300)},insertDisplayAds:function(e,t,n,a,i){var o,s,d=this;d.displayAdsConfig.enabled&&(o=d.prepareDisplayAdsObj(e,t,n,a,i))&&(s=[o.evtAll],d.displayAdsConfig&&d.displayAdsConfig.enabledAuto&&o.evtAuto&&s.push(o.evtAuto),d.fetchRenderAds(s,o.posConfAll))},prepareDisplayAdsObj:function(t,a,i,o,s){var d,l,c,u,f,A,p,m,h,b,g,v=this,C=v.displayAdsConfig,y=C.config,w=y.sa||"",R=C.positions||{},D=C.enableK2BeaconConf||!1,L=C.enableBucketSiteAttribute||!1,B=R.aboveFold||[],k=R.belowFold||[],S=R.custom||[],E=B.concat(k),T=E.length,N=[],P=[],V=[],I=null,O=null,F=null,x=null,M=null,H=C.lrecTimeout,_=n.Af.context.bucket||"",j=n.Af.context.region||"",U=n.Af.context.rid||"",G=n.Af.context.device||"",Y="hlAds",q=0;if(v.forceSpaceid&&(t=v.forceSpaceid),!t||!T||!y)return null;if(v.allowHostUrlAsReferrer&&n.location&&n.location.host&&n.location.protocol&&(m=n.location.protocol+"//"+n.location.host,n.location.pathname&&(m+=n.location.pathname)),s||(s=""),i&&(w+=" "+i),L&&_&&(w+=' Y-BUCKET="'+_+'"'),window.facCustomTimout&&window.facCustomTimout>0&&(w+=" ctout="+window.facCustomTimout),window.flSAKey&&"undefined"!==window.flInstalled&&(w+=" "+window.flSAKey+"="+window.flInstalled),H&&(H=parseInt(H,10)),y.customSaAttrs&&y.customSaAttrs.enabled&&""!==y.customSaAttrs.saAttrs&&(w+=" "+y.customSaAttrs.saAttrs),c={pg:{device:G,intl:j,property:s,rid:U,test:_}},u={pt:"article",pd:"modal",rid:U,sid:window.YAHOO&&window.YAHOO.i13n&&window.YAHOO.i13n.currentSID||"",bucket:_},v.displayAdsObj&&!o){for((F=(p=v.displayAdsObj).evtAll).sp=t,F.sa=w,p.evtBelowFold&&(p.evtBelowFold.sp=t,p.evtBelowFold.sa=w),p.evtAboveFold&&(p.evtAboveFold.sp=t,p.evtAboveFold.sa=w),f=0,q=(V=p.posConfAll).length;f<q;f++)(A=V[f]).dest="hl-ad-"+A.id+"-"+a+"-iframe",A.clean="hl-ad-"+A.id,m&&(A.meta||(A.meta={}),A.meta.hostURL=m);return p}for(F={name:Y+"All",sp:t,ps:E.toString()||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},o&&(F.ps=o),D&&(F.pt="article",F.pd="modal",F.experience=u),S&&(T=(E=E.concat(S)).length),o&&(S=o.split(","),T=(E=E.concat(S)).length),E&&(h=v.displayAdsConfig.autoRT||45e3,b=v.displayAdsConfig.autoIV||1,g=v.displayAdsConfig.autoMax||25,x={name:"AUTO",autoStart:1,autoRT:1e4,autoDDG:v.displayAdsConfig.autoDDG,ddd:v.displayAdsConfig.ddd,sp:t,ps:v.generateAutoEvtPositions(E,h,b,g)||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},D&&(x.pt="article",x.pd="modal",
x.experience=u)),k.length>0&&(O={name:Y+"BelowFold",sp:t,ps:k.toString()||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},D&&(O.pt="article",O.pd="modal",O.experience=u)),B.length>0&&(I={name:Y+"AboveFold",sp:t,ps:B.toString()||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},D&&(I.pt="article",I.pd="modal",I.experience=u)),f=0;f<T;f++)d=E[f],(l=y[d])||(l=y[d.split("-")[0]+"-9"]),d&&l&&(A={dest:"hl-ad-"+d+"-"+a+"-iframe",id:d,h:l.h,w:l.w,pos:d,clean:"hl-ad-"+d.split("-")[0],fr:"expIfr_exp",supports:{"exp-ovr":1,"exp-push":1,lyr:1},metaSize:!0,fdb:!!l.fdb},l.z&&(A.z=l.z),l.closeBtn&&(A.closeBtn=l.closeBtn),l.supports&&(A.supports=l.supports),l.css&&(A.css=l.css),l.bg&&(A.bg=l.bg),l.meta&&(A.mega=l.meta),l.flex&&(A.flex=l.flex),m&&(A.meta||(A.meta={}),A.meta.hostURL=m),A.clean="hl-ad-"+d,H&&"LREC-0"===d&&C.lrecBackfill.link&&C.lrecBackfill.img&&(A.timeout=H,A.lowHTML='<a href="'+C.lrecBackfill.link+'"><img src="'+C.lrecBackfill.img+'" border="0">&nbsp;</a>\x3c!-- timeout fallback --\x3e'),V.push(A),B.indexOf(d)>=0?N.push(A):k.indexOf(d)>=0&&P.push(A));return v.commentsLREC&&r.forEach(function(t){if(y["LREC-9"]){var n=e.clone(y["LREC-9"]);n.clean="hl-ad-"+t,n.dest="hl-ad-"+t+"-iframe",n.pos=t,n.id=t,m&&(n.meta||(n.meta={}),n.meta.hostURL=m),V.push(n)}}),p={evtAboveFold:I,posConfAboveFold:N,evtBelowFold:O,posConfBelowFold:P,evtAll:F,evtAuto:x,evtCustom:M,posConfAll:V,positions:R},v.displayAdsObj=p,p},removeChildrenFromParent:function(e){var t,n,a;for(t=0,n=e.length;t<n;t++)(a=e[t]).parentNode.removeChild(a)},destroyAds:function(e){var t,n=this,i=n.displayAdsObj&&n.displayAdsObj.positions,o=e.getElementsByClassName(a);n.removeChildrenFromParent(o),t=e.getElementsByClassName(s),n.removeChildrenFromParent(t),n.drawer=null;try{"undefined"!=typeof DARLA&&i&&DARLA.render.RenderMgr.nuke(i)}catch(d){}n.unbeaconedAds=[]},abortDARLA:function(){"undefined"!=typeof DARLA&&DARLA.inProgress()&&DARLA.abort()},onRemoveAdBtnClick:function(t,n){var a=t.target.ancestor("div",!0,".Content-Body"),i={config:n.model.get("config"),ads:n.model.shift("smallCurveball"),adChoicesUrl:n.curveballConfig.adChoicesUrl,i18n:n.i18n,adsFDBList:n.model.get("adsFDBList"),context:n.context};t.preventDefault(),n.drawer&&(n.drawer.remove(),n.drawer=null),dust.render("td-applet-viewer-templates-drawer_feedback",i,function(t,i){!t&&i&&(a.insert(i,"after"),a.removeClass("Mb-20"),a.one(".js-ad-dislike-button").addClass("Hidden"),n.drawer=a.get("nextSibling"),e.later(100,n,function(){n.drawer.addClass("Collapse-opened"),n.adFeedbackOptionHandler(),n._feedbackBeacon(a.getAttribute("data-ad-feedback-beacon"),"start"),n.drawer.delegate(d,n.onActionAdBtnClick,".js-viewer-ad-done",n.context,n)}))})},onActionAdBtnClick:function(e,t){var n=e.target;e.preventDefault(),t.removeAd(n,t)},removeAd:function(e,t){var n=0,a=e.ancestor("."+s,!0),i=t.drawer.one("input[id=ads-dislike-option4]"),o=i?i.get("value"):0,d=t.drawer.one("#cmnt"),r=t.drawer.one(".custom_resp"),l=a.get("previousSibling");a.all("input").each(function(e){e.get("checked")&&(n=e.get("value"))}),n===o&&""===d.get("value")?r&&(r.removeClass("Hidden"),r.addClass("required"),d.focus()):(t._feedbackBeacon(l.getAttribute("data-ad-feedback-beacon"),"submit",n,d.get("value")),t._closeDrawer(t,l))},_closeDrawer:function(t,n){var a={config:t.model.get("config"),ads:t.model.shift("smallCurveball"),adChoicesUrl:t.curveballConfig.adChoicesUrl,i18n:t.i18n,context:t.context};dust.render("td-applet-viewer-templates-ad_fdb_thank_you",a,function(a,i){!a&&i&&(n.get("nextSibling").remove(),n.insert(i,"after"),n.addClass("Hidden"),e.later(3e3,t,function(){n.get("nextSibling").remove(),n.remove(),t.drawer=null}))})},adFeedbackOptionHandler:function(){var e=this.drawer,t=this.drawer.one("#cmnt"),n=e.one(".custom_resp"),a=e.one("input[id=ads-dislike-option4]");this.drawer.all("input[type=radio]").each(function(i){i.on("change",function(i){e.one("input[name=fd]:checked").compareTo(a)?(n.removeClass("Hidden"),n.removeClass("required"),t.focus()):n.hasClass("Hidden")||(n.addClass("Hidden"),n.removeClass("required"))})})},_feedbackBeacon:function(t,n,a,i){var o="";t&&n&&(o+="type$fdb_"+n,a&&(o+=",subo$"+a),i?o+=",cmnt$"+escape(i):"submit"===n&&(o+=",cmnt$"),t=t.replace(/\$\(AD_FEEDBACK\)/,"("+o+")"),e.Af.Beacon.send(t))},fecthAdsWithOverride:function(e,t){if(e)if(DARLA.inProgress()){var n,a=0;n=setInterval(function(){a++,DARLA.inProgress()||(clearInterval(n),DARLA.event(e,t)),a>50&&clearInterval(n)},300)}else DARLA.event(e,t)},fetchRenderAds:function(t,n){var a,i,o,s,d=this;if(t&&n)try{a=function(e){if("AUTO"===e.name)DARLA.isAutoOn()||DARLA.startAuto();else if(DARLA.inProgress()){var t,n=0;t=setInterval(function(){n++,DARLA.inProgress()||(clearInterval(t),window._adCallStart&&window._adCallStart(),d.displayAdsConfig.monSponsorship?d.fetchMonSponsorshipAds(e.name):d.displayAdsConfig.enabledDeferRenderAds||d.displayAdsConfig.enableAdLayout?d.displayAdsConfig.enableAdLayout?d.fetchLayoutAds(e.name):d.deferRenderAds(e.name):DARLA.event(e.name)),n>50&&clearInterval(t)},300)}else window._adCallStart&&window._adCallStart(),d.displayAdsConfig.monSponsorship?d.fetchMonSponsorshipAds(e.name):d.displayAdsConfig.enabledDeferRenderAds||d.displayAdsConfig.enableAdLayout?d.displayAdsConfig.enableAdLayout?d.fetchLayoutAds(e.name):d.deferRenderAds(e.name):DARLA.event(e.name)},DARLA.inProgress()?(i=50,o=0,s=setInterval(function(){o++,DARLA.inProgress()||(clearInterval(s),e.Array.each(t,function(e){DARLA.add(e)}),DARLA.addPos(n),e.Array.each(t,function(e){a(e)})),o>i&&clearInterval(s)},300)):(e.Array.each(t,function(e){DARLA.add(e)}),DARLA.addPos(n),e.Array.each(t,function(e){a(e)}))}catch(r){}},onDisplayAdCallResp:function(t){var n,a,i,o=this,s=DARLA.prefetched(),d=this.validDesktopMoments,r=t&&!(!t["MON-0"]&&!t["MON2-0"]),l=t&&!!t["MON-0"],c=s.length;if(d||r)for(o.hlViewerNode||(o.hlViewerNode=e.one("#hl-viewer")),o.hlViewerNode&&o.hlViewerNode.addClass("hideGemini"),o.parent.disableStickyLREC2=!0,
i=0;i<c;i++)r&&o.displayAdsConfig.allowLDRBMON&&0===s[i].indexOf("LDRB")||r&&l&&o.displayAdsConfig.removeLREC3LREC4whenMON&&(0===s[i].indexOf("LREC3")||0===s[i].indexOf("LREC4"))||(d||r&&-1===s[i].indexOf("MON"))&&(n=DARLA.posSettings(s[i]),a=document.getElementById(n.clean),"LREC-0"!==s[i]&&(a&&(a.id+="-notused",a.className=a.className.replace("lrec-reserve-ht","")),(a=document.getElementById(n.dest))&&(a.id+="-notused",a.className+=" D-n")));else(a=o.hlViewerNode.one(".ldrb-before-loading"))&&a.setStyle("height","90px");setTimeout(function(){if(d||r){var e=document.getElementById("hl-ad-LREC-0");e&&(e.id+="-notused"),(e=document.getElementById("hl-ad-LREC-0-0-iframe"))&&(e.id+="-notused",e.className+=" D-n")}else!d&&r||(e=document.getElementById("hl-ad-LREC-0"))&&(e.parentElement.className=e.parentElement.className.replace("lrec-before-loading",""),e.parentElement.style.height="");DARLA.render()},50)},onValidDesktopmoments:function(){this.validDesktopMoments=!0},fetchMonSponsorshipAds:function(t){this.validDesktopMoments=!1,this.parent.disableStickyLREC2=!1,this.hlViewerNode||(this.hlViewerNode=e.one("#hl-viewer")),this.hlViewerNode&&this.hlViewerNode.removeClass("hideGemini"),DARLA.prefetch(t)},fetchLayoutAds:function(e){var t,n,a,i;if(this.adResponseFlushTimer&&(clearTimeout(this.adResponseFlushTimer),this.adResponseFlushTimer=null),DARLA.prefetch(e));else{if((t=DARLA.prefetched()).length>0){for(i=0;i<t.length;i++)a=DARLA.posSettings(t[i]),(n=document.getElementById(a.clean))&&(n.id+="-notused"),(n=document.getElementById(a.dest))&&(n.id+="-notused",n.className+=" D-n");for(DARLA.render(),i=0;i<t.length;i++)a=DARLA.posSettings(t[i]),(n=document.getElementById(a.clean+"-notused"))&&n.id.match(/-notused/)&&(n.id=n.id.replace(/-notused/,"")),(n=document.getElementById(a.dest+"-notused"))&&n.id.match(/-notused/)&&(n.id=n.id.replace(/-notused/),n.className.replace(/D-n/,""))}DARLA.prefetch(e)}},deferRenderAds:function(e){var t,n=DARLA.prefetch(e);n||((t=DARLA.prefetched()).length>0&&DARLA.render(t),n=DARLA.prefetch(e))},handleScroll:function(){var e=this;-1!==e.scrollTimer&&clearTimeout(e.scrollTimer),e.scrollTimer=setTimeout(function(){e.beaconVisibleAds(!0)},500)},fireAdsBeacon:function(t){var n,a,i;if(n=t.getAttribute("data-ad-story-beacon"),e.Af.Beacon.send(n),a=t.getAttribute("data-ad-impr-tracking"),i=t.getAttribute("data-thirdparty-beacons")){try{i=e.JSON.parse(i)}catch(o){}i&&e.Lang.isArray(i)&&e.Array.each(i,function(t){e.Af.Beacon.send(t)})}else a&&e.Af.Beacon.send(a)},firePartialViewBeacon:function(t){var n;(n=t.getAttribute("data-prtbc"))&&e.Af.Beacon.send(n)},fireGenericViewBeacon:function(t,n){var a;(a=t.getAttribute("data-gnvbc"))&&e.Af.Beacon.send(a.replace("$(S_VIEW_TYPE)",n))},checkViewabilityRule:function(e,t,n){var a=!1;return n>=e.p?(e.startTime||(e.startTime=t,e.viewTime||(e.viewTime=0)),e.c?t-e.startTime>1e3*e.d&&(a=!0):e.viewTime+t-e.startTime>1e3*e.d&&(a=!0)):(e.startTime&&!e.c&&(e.viewTime+=t-e.startTime),e.startTime=null),a},beaconVisibleAds:function(t){var n,a,i,o,s,d=this,r=+new Date;if(!d.curveballConfig.genericViewability&&d.unbeaconedAds.length>0)for(a=d.unbeaconedAds.length-1;a>=0;a--)n=d.unbeaconedAds[a],(t?d.checkInViewportRect(n,!0,.5):d.checkInViewport(n))&&(d.unbeaconedAds.splice(a,1),d.fireAdsBeacon(n));for(a=d.unbeaconedPrtAds.length-1;a>=0;a--)n=d.unbeaconedPrtAds[a],d.checkInViewportRect(n,!1,1)&&(d.unbeaconedPrtAds.splice(a,1),d.firePartialViewBeacon(n));if(d.curveballConfig.genericViewability&&d.unbeaconedGnvAds.length>0){for(o=!1,a=d.unbeaconedGnvAds.length-1;a>=0;a--){if(n=d.unbeaconedGnvAds[a],i=d.getVisiblePercentage(n.node),o=o||i>0,!n.defBeaconFired&&n.rules&&n.rules.viewabilityDefStatic&&(n.defBeaconFired=d.checkViewabilityRule(n.rules.viewabilityDefStatic,r,i),n.defBeaconFired&&d.fireAdsBeacon(n.node)),n.rules&&n.rules.viewabilityDefStatic3P)for(s=0;s<n.rules.viewabilityDefStatic3P.length;s++)d.checkViewabilityRule(n.rules.viewabilityDefStatic3P[s],r,i)&&(d.fireGenericViewBeacon(n.node,n.rules.viewabilityDefStatic3P[s].t),n.rules.viewabilityDefStatic3P.splice(s,1));!n.defBeaconFired||!n.rules||n.rules.viewabilityDefStatic3P&&0!==n.rules.viewabilityDefStatic3P.length||d.unbeaconedGnvAds.splice(a,1)}o&&e.later(1001,d,d.beaconVisibleAds,!1)}},fetchFPAds:function(e){var t=this.displayAdsFPConfig.pos||"",n=this.displayAdsFPConfig.config||{},a={name:"hlfp",sp:e,ps:t,ssl:!0,npv:!0};this.fetchRenderAds([a],n)},prefetch:function(){var e=this;e.curveballConfig.enabled&&(e.curveballConfig.fromCurveballAPI||e.smad&&e.smad.enabled)&&e.model.prefetch("smallCurveball")},isSMAdCached:function(){return this.model&&this.model.isSMAdCached("smallCurveball")},fireContentInitEvent:function(t){var n,a=this;a.videoAdPlayers={},t.isVideo&&(n={id:t.id,link:t.link,eligible:!1,type:"3",videoAdAssets:t.video_ad_assets,videoAdBeacons:t.actionUrls,videoAdImage:t.prtimage&&t.prtimage.url,videoAdRules:t.rules},n=[].concat(n),e.Af.Event.fire("content-video:init",{guid:a.guid,list:n,fullList:n}))},onCreatePlayerInstance:function(e){var t,n,a,i=this;i&&(t=e.playerNode.ancestor(".js-viewer-smad"))&&(n=window.YAHOO&&window.YAHOO.VideoPlatform.API_Events,(a=t.one(".mute-btn"))&&(i.videoAdPlayers[t.generateID()]=e.player,e.player.on(n.AD_PLAYBACK_START,function(){a.show()}),t.hasClass("js-viewer-smad")||e.player.on(n.AD_PLAYBACK_STOP,function(){a.hide()})))},pauseSMAd:function(){this&&this.videoAdPlayers&&e.each(this.videoAdPlayers,function(e){e.controls.pause()})},playSMAd:function(){var t=this;t&&t.videoAdPlayers&&e.each(t.videoAdPlayers,function(n){var a,i=e.one(".js-viewer-smad .js-smad-container");i&&(i=i.getDOMNode())&&(a=t.getVisiblePercentage(i))&&a>=50&&n.controls.play()})},manageFooterVisibility:function(){var t,n,i,o=e.one("."+a),s=this.ads;o&&s&&(t=o.one(".js-smad-clip"))&&(n=t.getDOMNode())&&(i=n.getBoundingClientRect(),s.ctaNode&&s.ctaNode.hasClass("V-h")&&s.ctaNode.removeClass("V-h"),
s.muteBtnNode&&s.muteBtnNode.hasClass("V-h")&&s.muteBtnNode.removeClass("V-h"),s.footerTop&&s.footerBottom&&i&&(s.footerBottom>i.bottom||s.footerTop<i.top)?(s.ctaNode&&!s.ctaNode.hasClass("Hidden")&&s.ctaNode.addClass("Hidden"),s.muteBtnNode&&!s.muteBtnNode.hasClass("Hidden")&&s.muteBtnNode.addClass("Hidden")):(s.ctaNode&&s.ctaNode.hasClass("Hidden")&&s.ctaNode.removeClass("Hidden"),s.muteBtnNode&&s.muteBtnNode.hasClass("Hidden")&&s.muteBtnNode.removeClass("Hidden")))},onClickAdMuteBtn:function(e){var t,n,a=this,i=e.target,o=i.ancestor(".js-viewer-smad");o&&a.videoAdPlayers&&a.videoAdPlayers[o.generateID()]&&(t=a.videoAdPlayers[o.generateID()],(n=o.one(".mute-btn"))&&(n.hasClass("mute-on")?(t.controls.setMute(!1),n.replaceClass("mute-on","mute-off")):(t.controls.setMute(!0),n.replaceClass("mute-off","mute-on"))))},onClickSMAd:function(t){var a,i=this,o=i.smad&&i.smad.asyncBeaconWait||300,s=t.currentTarget,d=s.ancestor(".js-viewer-smad"),r=d&&d.getData("asyncbeacon");if(s&&r){for(t.halt(!0),e.Af.Beacon.send(r),a=new Date;new Date-a<=o;);s.getAttribute("target")&&"_blank"===s.getAttribute("target")?n.open(s.getAttribute("href"),"blank"):n.location=s.getAttribute("href")}},insertCurveball:function(t,n){var i,s,r,l,c,u,f=this,A=null;if(!t||!f.curveballConfig.enabled)return null;if((i={ads:f.model.shift("smallCurveball"),adChoicesUrl:f.curveballConfig.adChoicesUrl,i18n:f.i18n,context:f.context,enableAdsFeedback:f.enableAdsFeedback,isSlideShow:f.contentType&&"slideshow"===f.contentType})&&i.ads&&f.smad&&f.smad.enabled&&(i.smadConfig=f.smad),i&&i.ads&&i.ads.imprTrackingUrls)try{i.ads.imprTrackingUrls=e.JSON.stringify(i.ads.imprTrackingUrls)}catch(p){}if(i&&i.ads&&i.ads.smad?dust.render(f.template,i,function(i,s){if(!i&&s){if(A=t.querySelector("."+a))if(n)n.parentNode.removeChild(A);else t.removeChild(A);(A=document.createElement("div")).innerHTML=s,A=A.querySelector("."+a),f.enableAdsFeedback&&e.later(100,f,function(){f.parent.container.one(o)&&f.parent.container.delegate(d,f.onRemoveAdBtnClick,o,f.context,f)})}}):A=t.querySelector("."+a),A)if(n)n.parentNode.insertBefore(A,n),f.fireContentInitEvent(i.ads),(l=e.one(A))&&(f.ctaNode=l.one(".js-smad-cta"),f.muteBtnNode=l.one(".mute-btn")),f.ctaNode&&(c=f.ctaNode.getDOMNode())&&(u=c.getBoundingClientRect())&&(f.footerTop=u.top,f.footerBottom=u.bottom);else{for(s=t.firstChild,r=f.curveballConfig.positionThreshold;s&&(!(s.offsetTop>r)||f.hasEmbed(s)||f.hasEmbed(s.nextSibling));s=s.nextSibling);t.insertBefore(A,s)}return i&&i.ads&&i.ads.smad&&f.smad&&f.smad.enabled&&(i.ads.asyncBeacon&&(f.clickSMAdEvent=f.parent.container.delegate(d,f.onClickSMAd,".js-smad-container",f)),f.clickMuteBtnEvent=f.parent.container.delegate(d,f.onClickAdMuteBtn,".mute-btn",f)),A},destroySMAdEvents:function(){var e=this;e.pauseSMAd(),e.clickSMAdEvent&&e.clickSMAdEvent.detach(),e.clickMuteBtnEvent&&e.clickMuteBtnEvent.detach()},getDimension:function(e){for(var t={top:0,bottom:e.offsetHeight};e;e=e.offsetParent)t.top+=e.offsetTop;return t.bottom+=t.top,t},setContentType:function(e){this.contentType=e},checkInViewport:function(e){for(var t=n.pageYOffset,a=t+n.innerHeight,i=0,o=e.offsetHeight,s=o/2;e;e=e.offsetParent)i+=e.offsetTop;return!(i+o-s<t||i+s>a)},checkInViewportRect:function(e,t,a){var i=e.offsetHeight,o=e.getBoundingClientRect(),s=o.right-o.left,d=o.bottom-o.top,r=n.innerHeight,l=n.innerWidth,c=o.top>=0&&Math.min(r,o.bottom)-o.top,u=o.left>=0&&Math.min(l,o.right)-o.left;return c=c||o.bottom,u=u||o.right,!(0>c||0>u||0===i)&&u*c>=(t?s*d*a:s*a)},getVisiblePercentage:function(e){var t,a=e.offsetHeight,i=e.getBoundingClientRect(),o=i.right-i.left,s=i.bottom-i.top,d=n.innerHeight,r=n.innerWidth,l=i.top>=0&&Math.min(d,i.bottom)-i.top,c=i.left>=0&&Math.min(r,i.right)-i.left;return l=l||i.bottom,c=c||i.right,0>l||0>c||0===a?0:0===(t=o*s)?0:100*c*l/t},hasEmbed:function(e){if(!e||3===e.nodeType)return!1;var t=e.classList;return!!t.contains("hasEmbed")||(!!t.contains("continue_reading")||("curveball_container"===e.id||!!e.querySelector("img, iframe, embed, table, video, object, .js-video-placeholder, em, a")&&(t.add("hasEmbed"),!0)))},generateAutoEvtPositions:function(e,t,n,a){var i,o={};if(!e||e.length<=0)return"";for(i=0;i<e.length;i++)this.displayAdsConfig.monSponsorship&&e[i].indexOf("MON")>=0||(o[e[i]]={autoRT:t,autoIV:n,autoMax:a});return this.commentsLREC&&r.forEach(function(e){o[e]={autoDDG:0,autoRT:t,autoIV:n,autoMax:a}}),o}},e.namespace("TD.Viewer").Ads=l},"@VERSION@",{requires:["af-beacon","af-config","af-event"]});
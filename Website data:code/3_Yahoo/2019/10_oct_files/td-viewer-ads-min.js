YUI.add("td-viewer-ads",function(e,t){"use strict";var n=e.config.win,i="ads-story",o=e.Af.Event,a=".js-ad-dislike-button",s="js-viewer-adfdb-options",d=e.UA.android||e.UA.ie?"click":"tap",r=["LREC2-4","LREC2-5","LREC2-6","LREC2-7","LREC2-8","LREC3-4","LREC3-5","LREC3-6","LREC3-7","LREC3-8"];function l(e){var t=this;t.model=e.model,t.i18n=e.i18n,t.context=e.context,t.template=e.template,t.displayAdsConfig=e.config.displayAds,t.enableAdsFeedback=e.config.enableAdsFeedback,t.forceSpaceid=t.displayAdsConfig.forced_modalspaceid,t.displayAdsFPConfig=e.config.displayAdsFP,t.smad=e.config.smad,t.guid=e.guid,t.curveballConfig=e.config.curveball,t.parent=e.view,t.displayAdsObj=null,t.drawer=null,t.scrollTimer=-1,t.init(),t.commentsLREC=e.commentsLREC||!1,t.allowHostUrlAsReferrer=e.config.allowHostUrlAsReferrer||!1,t.displayAdsConfig.enableAdLayout&&(t.adResponseFlushTimer=null)}l.prototype={init:function(){var t=this;t.unbeaconedAds=[],t.unbeaconedPrtAds=[],t.unbeaconedGnvAds=[],t.displayAdsFPConfig.enabled&&e.Global.on("hlads:fp",function(e){t.fetchFPAds(e.spaceid)}),(t.curveballConfig.enabled||t.curveballConfig.enableBeaconListenerOnly)&&(o.on("curveball:append",function(n){t.unbeaconedAds=t.unbeaconedAds.concat(n.ads||[]),e.Array.each(n.ads||[],function(e){e.getAttribute("data-prtbc")&&(t.unbeaconedPrtAds=t.unbeaconedPrtAds.concat(e))}),t.curveballConfig.genericViewability&&(t.unbeaconedGnvAds=t.unbeaconedGnvAds.concat(e.Array.map(n.ads||[],function(t){var n=t.getAttribute("data-vwrules");try{n=e.JSON.parse(n)}catch(i){}return{node:t,rules:n}})))}),t.curveballConfig.enableVisibilityRect?n.addEventListener("scroll",t.handleScroll.bind(t),!1):n.addEventListener("scroll",t.beaconVisibleAds.bind(t),!1)),o.on("sidekick:load",t.onSidekickLoad.bind(t),!1),t.displayAdsConfig.monSponsorship&&(t.hlViewerNode=e.one("#hl-viewer"),o.on("sidekickrefresh",t.onDisplayAdCallResp.bind(t),!1)),t.displayAdsConfig.enableAdboost&&t.registerTabSwitch()},registerTabSwitch:function(){var t,n,i,o=this,a=o.displayAdsConfig.adboostRotateTime;function s(){if(!i)return n=t(),void(i=!0)}function d(){var s,d,r=e.one(".Reader-open");r&&(window.disableAdboost||t()-n<a||(e.Af&&e.Af.PageViz&&e.Af.PageViz.isHidden()?i=!0:(i=!1,s=[],window.DARLA&&!window.DARLA.inProgress()&&(window.DARLA&&((d=window.DARLA.evtSettings("hlAdsAll")).ps&&d.ps.split(",")||[]).forEach(function(t){var n,i,a=DARLA.posSettings(t);a&&(n=document.getElementById(a.dest))&&o.checkInViewportRect(n,!1,1)&&(i=e.one("#"+a.dest))&&i.get("offsetHeight")>1&&s.push(t)}),s.length>0&&window.DARLA.event("hlAdsAll",{ps:s.join(",")})))))}(a=a&&parseInt(a,10)||0)>0&&(t=Date.now||function(){return(new Date).getTime()},n=t(),i=e.Af&&e.Af.PageViz&&e.Af.PageViz.isHidden()||!1,e.on("blur",s,window),e.on("focus",d,window),e.Af&&e.Af.PageViz&&(e.Af.PageViz.on("visible",d,o),e.Af.PageViz.on("hidden",s,o)))},updatePageIndex:function(e,t){var n,i;for(t=t||0,n=0,i=e.length;n<i;n++)e[n].pageIndex=t+n,e[n].reverseZindex=10-n},onSidekickLoad:function(e){var t=this,n=DARLA.prefetched();n&&0!==n.length?t.renderSidekickDisplayAds(e):setTimeout(function(){t.renderSidekickDisplayAds(e)},500)},renderSidekickDisplayAds:function(e){var t,n,i,o,a,s=this,d=DARLA.prefetched(),r=[],l=[];if(d.length>0)for(o=0;o<d.length;o++){for(t=!1,a=0;a<e.positions.length;a++)if(e.positions[a]+"-0"===d[o]){t=!0;break}t||!d[o].match(/LREC/)?r.push(d[o]):l.push(d[o])}for(o=0;o<l.length;o++)i=DARLA.posSettings(l[o]),(n=document.getElementById(i.clean)||document.getElementById(i.clean+"-notused"))&&(n.id.match(/-notused/)||(n.id+="-notused"),n.parentElement.className=n.parentElement.className.replace("lrec-before-loading",""),n.className=n.className.replace("lrec-reserve-ht","")),(n=document.getElementById(i.dest)||document.getElementById(i.dest+"-notused"))&&(n.id.match(/-notused/)||(n.id+="-notused",n.className+=" D-n"));DARLA.render(r),this.adResponseFlushTimer&&(clearTimeout(this.adResponseFlushTimer),this.adResponseFlushTimer=null),this.adResponseFlushTimer=setTimeout(function(){DARLA.render(),s.adResponseFlushTimer=null},1500)},insertAds:function(e,t,n,i,o,a){var s,d=this;d.insertDisplayAds(e,t,i,o,a),s=d.insertCurveball(n),d.unbeaconedAds=d.unbeaconedAds.concat(s||[]),d.unbeaconedAds.length>0&&setTimeout(function(){d.curveballConfig.enableVisibilityRect?d.beaconVisibleAds(!0):d.beaconVisibleAds()},300)},insertGeminiAdsOnly:function(e,t){var n,i=this;n=i.insertCurveball(e,t),i.unbeaconedAds=i.unbeaconedAds.concat(n||[]),i.unbeaconedAds.length>0&&setTimeout(function(){i.curveballConfig.enableVisibilityRect?i.beaconVisibleAds(!0):i.beaconVisibleAds()},300)},insertDisplayAds:function(e,t,n,i,o){var a,s,d=this;d.displayAdsConfig.enabled&&(a=d.prepareDisplayAdsObj(e,t,n,i,o))&&(s=[a.evtAll],d.displayAdsConfig&&d.displayAdsConfig.enabledAuto&&a.evtAuto&&s.push(a.evtAuto),d.fetchRenderAds(s,a.posConfAll))},prepareDisplayAdsObj:function(t,i,o,a,s){var d,l,c,u,f,A,p,m,h,g,b,v=this,C=v.displayAdsConfig,y=C.config,w=y.sa||"",R=C.positions||{},D=C.enableK2BeaconConf||!1,L=C.enableBucketSiteAttribute||!1,B=R.aboveFold||[],S=R.belowFold||[],k=R.custom||[],E=B.concat(S),T=E.length,P=[],N=[],V=[],I=null,O=null,F=null,x=null,M=null,H=C.lrecTimeout,_=n.Af.context.bucket||"",j=n.Af.context.region||"",U=n.Af.context.rid||"",G=n.Af.context.device||"",z="hlAds",Y=0;if(v.forceSpaceid&&(t=v.forceSpaceid),!t||!T||!y)return null;if(v.allowHostUrlAsReferrer&&n.location&&n.location.host&&n.location.protocol&&(m=n.location.protocol+"//"+n.location.host,n.location.pathname&&(m+=n.location.pathname)),s||(s=""),o&&(w+=" "+o),L&&_&&(w+=' Y-BUCKET="'+_+'"'),window.facCustomTimout&&window.facCustomTimout>0&&(w+=" ctout="+window.facCustomTimout),window.flSAKey&&"undefined"!==window.flInstalled&&(w+=" "+window.flSAKey+"="+window.flInstalled),H&&(H=parseInt(H,10)),y.customSaAttrs&&y.customSaAttrs.enabled&&""!==y.customSaAttrs.saAttrs&&(w+=" "+y.customSaAttrs.saAttrs),c={pg:{device:G,intl:j,property:s,rid:U,test:_}},u={pt:"article",pd:"modal",rid:U,
sid:window.YAHOO&&window.YAHOO.i13n&&window.YAHOO.i13n.currentSID||"",bucket:_},v.displayAdsObj&&!a){for((F=(p=v.displayAdsObj).evtAll).sp=t,F.sa=w,p.evtBelowFold&&(p.evtBelowFold.sp=t,p.evtBelowFold.sa=w),p.evtAboveFold&&(p.evtAboveFold.sp=t,p.evtAboveFold.sa=w),f=0,Y=(V=p.posConfAll).length;f<Y;f++)(A=V[f]).dest="hl-ad-"+A.id+"-"+i+"-iframe",A.clean="hl-ad-"+A.id,m&&(A.meta||(A.meta={}),A.meta.hostURL=m);return p}for(F={name:z+"All",sp:t,ps:E.toString()||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},a&&(F.ps=a),D&&(F.pt="article",F.pd="modal",F.experience=u),k&&(T=(E=E.concat(k)).length),a&&(k=a.split(","),T=(E=E.concat(k)).length),E&&(h=v.displayAdsConfig.autoRT||45e3,g=v.displayAdsConfig.autoIV||1,b=v.displayAdsConfig.autoMax||25,x={name:"AUTO",autoStart:1,autoRT:1e4,autoDDG:v.displayAdsConfig.autoDDG,ddd:v.displayAdsConfig.ddd,sp:t,ps:v.generateAutoEvtPositions(E,h,g,b)||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},D&&(x.pt="article",x.pd="modal",x.experience=u)),S.length>0&&(O={name:z+"BelowFold",sp:t,ps:S.toString()||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},D&&(O.pt="article",O.pd="modal",O.experience=u)),B.length>0&&(I={name:z+"AboveFold",sp:t,ps:B.toString()||"",property:s,ssl:!0,npv:!0,sa:w,ult:c},D&&(I.pt="article",I.pd="modal",I.experience=u)),f=0;f<T;f++)d=E[f],(l=y[d])||(l=y[d.split("-")[0]+"-9"]),d&&l&&(A={dest:"hl-ad-"+d+"-"+i+"-iframe",id:d,h:l.h,w:l.w,pos:d,clean:"hl-ad-"+d.split("-")[0],fr:"expIfr_exp",supports:{"exp-ovr":1,"exp-push":1,lyr:1},metaSize:!0,fdb:!!l.fdb},l.z&&(A.z=l.z),l.closeBtn&&(A.closeBtn=l.closeBtn),l.supports&&(A.supports=l.supports),l.css&&(A.css=l.css),l.bg&&(A.bg=l.bg),l.meta&&(A.mega=l.meta),l.flex&&(A.flex=l.flex),m&&(A.meta||(A.meta={}),A.meta.hostURL=m),A.clean="hl-ad-"+d,H&&"LREC-0"===d&&C.lrecBackfill.link&&C.lrecBackfill.img&&(A.timeout=H,A.lowHTML='<a href="'+C.lrecBackfill.link+'"><img src="'+C.lrecBackfill.img+'" border="0">&nbsp;</a>\x3c!-- timeout fallback --\x3e'),V.push(A),B.indexOf(d)>=0?P.push(A):S.indexOf(d)>=0&&N.push(A));return v.commentsLREC&&r.forEach(function(t){if(y["LREC-9"]){var n=e.clone(y["LREC-9"]);n.clean="hl-ad-"+t,n.dest="hl-ad-"+t+"-iframe",n.pos=t,n.id=t,m&&(n.meta||(n.meta={}),n.meta.hostURL=m),V.push(n)}}),p={evtAboveFold:I,posConfAboveFold:P,evtBelowFold:O,posConfBelowFold:N,evtAll:F,evtAuto:x,evtCustom:M,posConfAll:V,positions:R},v.displayAdsObj=p,p},removeChildrenFromParent:function(e){var t,n,i;for(t=0,n=e.length;t<n;t++)(i=e[t]).parentNode.removeChild(i)},destroyAds:function(e){var t,n=this,o=n.displayAdsObj&&n.displayAdsObj.positions,a=e.getElementsByClassName(i);n.removeChildrenFromParent(a),t=e.getElementsByClassName(s),n.removeChildrenFromParent(t),n.drawer=null;try{"undefined"!=typeof DARLA&&o&&DARLA.render.RenderMgr.nuke(o)}catch(d){}n.unbeaconedAds=[]},abortDARLA:function(){"undefined"!=typeof DARLA&&DARLA.inProgress()&&DARLA.abort()},onRemoveAdBtnClick:function(t,n){var i=t.target.ancestor("div",!0,".Content-Body"),o={config:n.model.get("config"),ads:n.model.shift("smallCurveball"),adChoicesUrl:n.curveballConfig.adChoicesUrl,i18n:n.i18n,adsFDBList:n.model.get("adsFDBList"),context:n.context};t.preventDefault(),n.drawer&&(n.drawer.remove(),n.drawer=null),dust.render("td-applet-viewer-templates-drawer_feedback",o,function(t,o){!t&&o&&(i.insert(o,"after"),i.removeClass("Mb-20"),i.one(".js-ad-dislike-button").addClass("Hidden"),n.drawer=i.get("nextSibling"),e.later(100,n,function(){n.drawer.addClass("Collapse-opened"),n.adFeedbackOptionHandler(),n._feedbackBeacon(i.getAttribute("data-ad-feedback-beacon"),"start"),n.drawer.delegate(d,n.onActionAdBtnClick,".js-viewer-ad-done",n.context,n)}))})},onActionAdBtnClick:function(e,t){var n=e.target;e.preventDefault(),t.removeAd(n,t)},removeAd:function(e,t){var n=0,i=e.ancestor("."+s,!0),o=t.drawer.one("input[id=ads-dislike-option4]"),a=o?o.get("value"):0,d=t.drawer.one("#cmnt"),r=t.drawer.one(".custom_resp"),l=i.get("previousSibling");i.all("input").each(function(e){e.get("checked")&&(n=e.get("value"))}),n===a&&""===d.get("value")?r&&(r.removeClass("Hidden"),r.addClass("required"),d.focus()):(t._feedbackBeacon(l.getAttribute("data-ad-feedback-beacon"),"submit",n,d.get("value")),t._closeDrawer(t,l))},_closeDrawer:function(t,n){var i={config:t.model.get("config"),ads:t.model.shift("smallCurveball"),adChoicesUrl:t.curveballConfig.adChoicesUrl,i18n:t.i18n,context:t.context};dust.render("td-applet-viewer-templates-ad_fdb_thank_you",i,function(i,o){!i&&o&&(n.get("nextSibling").remove(),n.insert(o,"after"),n.addClass("Hidden"),e.later(3e3,t,function(){n.get("nextSibling").remove(),n.remove(),t.drawer=null}))})},adFeedbackOptionHandler:function(){var e=this.drawer,t=this.drawer.one("#cmnt"),n=e.one(".custom_resp"),i=e.one("input[id=ads-dislike-option4]");this.drawer.all("input[type=radio]").each(function(o){o.on("change",function(o){e.one("input[name=fd]:checked").compareTo(i)?(n.removeClass("Hidden"),n.removeClass("required"),t.focus()):n.hasClass("Hidden")||(n.addClass("Hidden"),n.removeClass("required"))})})},_feedbackBeacon:function(t,n,i,o){var a="";t&&n&&(a+="type$fdb_"+n,i&&(a+=",subo$"+i),o?a+=",cmnt$"+escape(o):"submit"===n&&(a+=",cmnt$"),t=t.replace(/\$\(AD_FEEDBACK\)/,"("+a+")"),e.Af.Beacon.send(t))},fecthAdsWithOverride:function(e,t){if(e)if(DARLA.inProgress()){var n,i=0;n=setInterval(function(){i++,DARLA.inProgress()||(clearInterval(n),DARLA.event(e,t)),i>50&&clearInterval(n)},300)}else DARLA.event(e,t)},fetchRenderAds:function(t,n){var i,o,a,s,d=this;if(t&&n)try{i=function(e){if("AUTO"===e.name)DARLA.isAutoOn()||DARLA.startAuto();else if(DARLA.inProgress()){var t,n=0;t=setInterval(function(){n++,DARLA.inProgress()||(clearInterval(t),window._adCallStart&&window._adCallStart(),d.displayAdsConfig.monSponsorship?d.fetchMonSponsorshipAds(e.name):d.displayAdsConfig.enabledDeferRenderAds||d.displayAdsConfig.enableAdLayout?d.displayAdsConfig.enableAdLayout?d.fetchLayoutAds(e.name):d.deferRenderAds(e.name):DARLA.event(e.name)),n>50&&clearInterval(t)},300)
}else window._adCallStart&&window._adCallStart(),d.displayAdsConfig.monSponsorship?d.fetchMonSponsorshipAds(e.name):d.displayAdsConfig.enabledDeferRenderAds||d.displayAdsConfig.enableAdLayout?d.displayAdsConfig.enableAdLayout?d.fetchLayoutAds(e.name):d.deferRenderAds(e.name):DARLA.event(e.name)},DARLA.inProgress()?(o=50,a=0,s=setInterval(function(){a++,DARLA.inProgress()||(clearInterval(s),e.Array.each(t,function(e){DARLA.add(e)}),DARLA.addPos(n),e.Array.each(t,function(e){i(e)})),a>o&&clearInterval(s)},300)):(e.Array.each(t,function(e){DARLA.add(e)}),DARLA.addPos(n),e.Array.each(t,function(e){i(e)}))}catch(r){}},onDisplayAdCallResp:function(t){var n,i,o,a=this,s=DARLA.prefetched(),d=this.validDesktopMoments,r=t&&!(!t["MON-0"]&&!t["MON2-0"]),l=t&&!!t["MON-0"],c=s.length;if(d||r)for(a.hlViewerNode||(a.hlViewerNode=e.one("#hl-viewer")),a.hlViewerNode&&!a.displayAdsConfig.monSponsorshipAllowGemini&&a.hlViewerNode.addClass("hideGemini"),a.parent.disableStickyLREC2=!0,o=0;o<c;o++)r&&a.displayAdsConfig.allowLDRBMON&&0===s[o].indexOf("LDRB")||r&&l&&a.displayAdsConfig.removeLREC3LREC4whenMON&&(0===s[o].indexOf("LREC3")||0===s[o].indexOf("LREC4"))||(d||r&&-1===s[o].indexOf("MON"))&&(n=DARLA.posSettings(s[o]),i=document.getElementById(n.clean),"LREC-0"!==s[o]&&(i&&(i.id+="-notused",i.className=i.className.replace("lrec-reserve-ht","")),(i=document.getElementById(n.dest))&&(i.id+="-notused",i.className+=" D-n")));else(i=a.hlViewerNode.one(".ldrb-before-loading"))&&i.setStyle("height","90px");setTimeout(function(){if(d||r){var e=document.getElementById("hl-ad-LREC-0");e&&(e.id+="-notused"),(e=document.getElementById("hl-ad-LREC-0-0-iframe"))&&(e.id+="-notused",e.className+=" D-n")}else!d&&r||(e=document.getElementById("hl-ad-LREC-0"))&&(e.parentElement.className=e.parentElement.className.replace("lrec-before-loading",""),e.parentElement.style.height="");DARLA.render()},50)},onValidDesktopmoments:function(){this.validDesktopMoments=!0},fetchMonSponsorshipAds:function(t){this.validDesktopMoments=!1,this.parent.disableStickyLREC2=!1,this.hlViewerNode||(this.hlViewerNode=e.one("#hl-viewer")),this.hlViewerNode&&this.hlViewerNode.removeClass("hideGemini"),DARLA.prefetch(t)},fetchLayoutAds:function(e){var t,n,i,o;if(this.adResponseFlushTimer&&(clearTimeout(this.adResponseFlushTimer),this.adResponseFlushTimer=null),DARLA.prefetch(e));else{if((t=DARLA.prefetched()).length>0){for(o=0;o<t.length;o++)i=DARLA.posSettings(t[o]),(n=document.getElementById(i.clean))&&(n.id+="-notused"),(n=document.getElementById(i.dest))&&(n.id+="-notused",n.className+=" D-n");for(DARLA.render(),o=0;o<t.length;o++)i=DARLA.posSettings(t[o]),(n=document.getElementById(i.clean+"-notused"))&&n.id.match(/-notused/)&&(n.id=n.id.replace(/-notused/,"")),(n=document.getElementById(i.dest+"-notused"))&&n.id.match(/-notused/)&&(n.id=n.id.replace(/-notused/),n.className.replace(/D-n/,""))}DARLA.prefetch(e)}},deferRenderAds:function(e){var t,n=DARLA.prefetch(e);n||((t=DARLA.prefetched()).length>0&&DARLA.render(t),n=DARLA.prefetch(e))},handleScroll:function(){var e=this;-1!==e.scrollTimer&&clearTimeout(e.scrollTimer),e.scrollTimer=setTimeout(function(){e.beaconVisibleAds(!0)},500)},fireAdsBeacon:function(t){var n,i,o;if(n=t.getAttribute("data-ad-story-beacon"),e.Af.Beacon.send(n),i=t.getAttribute("data-ad-impr-tracking"),o=t.getAttribute("data-thirdparty-beacons")){try{o=e.JSON.parse(o)}catch(a){}o&&e.Lang.isArray(o)&&e.Array.each(o,function(t){e.Af.Beacon.send(t)})}else i&&e.Af.Beacon.send(i)},firePartialViewBeacon:function(t){var n;(n=t.getAttribute("data-prtbc"))&&e.Af.Beacon.send(n)},fireGenericViewBeacon:function(t,n){var i;(i=t.getAttribute("data-gnvbc"))&&e.Af.Beacon.send(i.replace("$(S_VIEW_TYPE)",n))},checkViewabilityRule:function(e,t,n){var i=!1;return n>=e.p?(e.startTime||(e.startTime=t,e.viewTime||(e.viewTime=0)),e.c?t-e.startTime>1e3*e.d&&(i=!0):e.viewTime+t-e.startTime>1e3*e.d&&(i=!0)):(e.startTime&&!e.c&&(e.viewTime+=t-e.startTime),e.startTime=null),i},beaconVisibleAds:function(t){var n,i,o,a,s,d=this,r=+new Date;if(!d.curveballConfig.genericViewability&&d.unbeaconedAds.length>0)for(i=d.unbeaconedAds.length-1;i>=0;i--)n=d.unbeaconedAds[i],(t?d.checkInViewportRect(n,!0,.5):d.checkInViewport(n))&&(d.unbeaconedAds.splice(i,1),d.fireAdsBeacon(n));for(i=d.unbeaconedPrtAds.length-1;i>=0;i--)n=d.unbeaconedPrtAds[i],d.checkInViewportRect(n,!1,1)&&(d.unbeaconedPrtAds.splice(i,1),d.firePartialViewBeacon(n));if(d.curveballConfig.genericViewability&&d.unbeaconedGnvAds.length>0){for(a=!1,i=d.unbeaconedGnvAds.length-1;i>=0;i--){if(n=d.unbeaconedGnvAds[i],o=d.getVisiblePercentage(n.node),a=a||o>0,!n.defBeaconFired&&n.rules&&n.rules.viewabilityDefStatic&&(n.defBeaconFired=d.checkViewabilityRule(n.rules.viewabilityDefStatic,r,o),n.defBeaconFired&&d.fireAdsBeacon(n.node)),n.rules&&n.rules.viewabilityDefStatic3P)for(s=0;s<n.rules.viewabilityDefStatic3P.length;s++)d.checkViewabilityRule(n.rules.viewabilityDefStatic3P[s],r,o)&&(d.fireGenericViewBeacon(n.node,n.rules.viewabilityDefStatic3P[s].t),n.rules.viewabilityDefStatic3P.splice(s,1));!n.defBeaconFired||!n.rules||n.rules.viewabilityDefStatic3P&&0!==n.rules.viewabilityDefStatic3P.length||d.unbeaconedGnvAds.splice(i,1)}a&&e.later(1001,d,d.beaconVisibleAds,!1)}},fetchFPAds:function(e){var t=this.displayAdsFPConfig.pos||"",n=this.displayAdsFPConfig.config||{},i={name:"hlfp",sp:e,ps:t,ssl:!0,npv:!0};this.fetchRenderAds([i],n)},prefetch:function(){var e=this;e.curveballConfig.enabled&&(e.curveballConfig.fromCurveballAPI||e.smad&&e.smad.enabled)&&e.model.prefetch("smallCurveball")},isSMAdCached:function(){return this.model&&this.model.isSMAdCached("smallCurveball")},fireContentInitEvent:function(t){var n,i=this;i.videoAdPlayers={},t.isVideo&&(n={id:t.id,link:t.link,eligible:!1,type:"3",videoAdAssets:t.video_ad_assets,videoAdBeacons:t.actionUrls,videoAdImage:t.prtimage&&t.prtimage.url,videoAdRules:t.rules},n=[].concat(n),e.Af.Event.fire("content-video:init",{guid:i.guid,list:n,fullList:n}))},
onCreatePlayerInstance:function(e){var t,n,i,o=this;o&&(t=e.playerNode.ancestor(".js-viewer-smad"))&&(n=window.YAHOO&&window.YAHOO.VideoPlatform.API_Events,(i=t.one(".mute-btn"))&&(o.videoAdPlayers[t.generateID()]=e.player,e.player.on(n.AD_PLAYBACK_START,function(){i.show()}),t.hasClass("js-viewer-smad")||e.player.on(n.AD_PLAYBACK_STOP,function(){i.hide()})))},pauseSMAd:function(){this&&this.videoAdPlayers&&e.each(this.videoAdPlayers,function(e){e.controls.pause()})},playSMAd:function(){var t=this;t&&t.videoAdPlayers&&e.each(t.videoAdPlayers,function(n){var i,o=e.one(".js-viewer-smad .js-smad-container");o&&(o=o.getDOMNode())&&(i=t.getVisiblePercentage(o))&&i>=50&&n.controls.play()})},manageFooterVisibility:function(){var t,n,o,a=e.one("."+i),s=this.ads;a&&s&&(t=a.one(".js-smad-clip"))&&(n=t.getDOMNode())&&(o=n.getBoundingClientRect(),s.ctaNode&&s.ctaNode.hasClass("V-h")&&s.ctaNode.removeClass("V-h"),s.muteBtnNode&&s.muteBtnNode.hasClass("V-h")&&s.muteBtnNode.removeClass("V-h"),s.footerTop&&s.footerBottom&&o&&(s.footerBottom>o.bottom||s.footerTop<o.top)?(s.ctaNode&&!s.ctaNode.hasClass("Hidden")&&s.ctaNode.addClass("Hidden"),s.muteBtnNode&&!s.muteBtnNode.hasClass("Hidden")&&s.muteBtnNode.addClass("Hidden")):(s.ctaNode&&s.ctaNode.hasClass("Hidden")&&s.ctaNode.removeClass("Hidden"),s.muteBtnNode&&s.muteBtnNode.hasClass("Hidden")&&s.muteBtnNode.removeClass("Hidden")))},onClickAdMuteBtn:function(e){var t,n,i=this,o=e.target,a=o.ancestor(".js-viewer-smad");a&&i.videoAdPlayers&&i.videoAdPlayers[a.generateID()]&&(t=i.videoAdPlayers[a.generateID()],(n=a.one(".mute-btn"))&&(n.hasClass("mute-on")?(t.controls.setMute(!1),n.replaceClass("mute-on","mute-off")):(t.controls.setMute(!0),n.replaceClass("mute-off","mute-on"))))},onClickSMAd:function(t){var i,o=this,a=o.smad&&o.smad.asyncBeaconWait||300,s=t.currentTarget,d=s.ancestor(".js-viewer-smad"),r=d&&d.getData("asyncbeacon");if(s&&r){for(t.halt(!0),e.Af.Beacon.send(r),i=new Date;new Date-i<=a;);s.getAttribute("target")&&"_blank"===s.getAttribute("target")?n.open(s.getAttribute("href"),"blank"):n.location=s.getAttribute("href")}},insertCurveball:function(t,n){var o,s,r,l,c,u,f=this,A=null;if(!t||!f.curveballConfig.enabled)return null;if((o={ads:f.model.shift("smallCurveball"),adChoicesUrl:f.curveballConfig.adChoicesUrl,i18n:f.i18n,context:f.context,enableAdsFeedback:f.enableAdsFeedback,isSlideShow:f.contentType&&"slideshow"===f.contentType})&&o.ads&&f.smad&&f.smad.enabled&&(o.smadConfig=f.smad),o&&o.ads&&o.ads.imprTrackingUrls)try{o.ads.imprTrackingUrls=e.JSON.stringify(o.ads.imprTrackingUrls)}catch(p){}if(o&&o.ads&&o.ads.smad?dust.render(f.template,o,function(o,s){if(!o&&s){if(A=t.querySelector("."+i))if(n)n.parentNode.removeChild(A);else t.removeChild(A);(A=document.createElement("div")).innerHTML=s,A=A.querySelector("."+i),f.enableAdsFeedback&&e.later(100,f,function(){f.parent.container.one(a)&&f.parent.container.delegate(d,f.onRemoveAdBtnClick,a,f.context,f)})}}):A=t.querySelector("."+i),A)if(n)n.parentNode.insertBefore(A,n),f.fireContentInitEvent(o.ads),(l=e.one(A))&&(f.ctaNode=l.one(".js-smad-cta"),f.muteBtnNode=l.one(".mute-btn")),f.ctaNode&&(c=f.ctaNode.getDOMNode())&&(u=c.getBoundingClientRect())&&(f.footerTop=u.top,f.footerBottom=u.bottom);else{for(s=t.firstChild,r=f.curveballConfig.positionThreshold;s&&(!(s.offsetTop>r)||f.hasEmbed(s)||f.hasEmbed(s.nextSibling));s=s.nextSibling);t.insertBefore(A,s)}return o&&o.ads&&o.ads.smad&&f.smad&&f.smad.enabled&&(o.ads.asyncBeacon&&(f.clickSMAdEvent=f.parent.container.delegate(d,f.onClickSMAd,".js-smad-container",f)),f.clickMuteBtnEvent=f.parent.container.delegate(d,f.onClickAdMuteBtn,".mute-btn",f)),A},destroySMAdEvents:function(){var e=this;e.pauseSMAd(),e.clickSMAdEvent&&e.clickSMAdEvent.detach(),e.clickMuteBtnEvent&&e.clickMuteBtnEvent.detach()},getDimension:function(e){for(var t={top:0,bottom:e.offsetHeight};e;e=e.offsetParent)t.top+=e.offsetTop;return t.bottom+=t.top,t},setContentType:function(e){this.contentType=e},checkInViewport:function(e){for(var t=n.pageYOffset,i=t+n.innerHeight,o=0,a=e.offsetHeight,s=a/2;e;e=e.offsetParent)o+=e.offsetTop;return!(o+a-s<t||o+s>i)},checkInViewportRect:function(e,t,i){var o=e.offsetHeight,a=e.getBoundingClientRect(),s=a.right-a.left,d=a.bottom-a.top,r=n.innerHeight,l=n.innerWidth,c=a.top>=0&&Math.min(r,a.bottom)-a.top,u=a.left>=0&&Math.min(l,a.right)-a.left;return c=c||a.bottom,u=u||a.right,!(0>c||0>u||0===o)&&u*c>=(t?s*d*i:s*i)},getVisiblePercentage:function(e){var t,i=e.offsetHeight,o=e.getBoundingClientRect(),a=o.right-o.left,s=o.bottom-o.top,d=n.innerHeight,r=n.innerWidth,l=o.top>=0&&Math.min(d,o.bottom)-o.top,c=o.left>=0&&Math.min(r,o.right)-o.left;return l=l||o.bottom,c=c||o.right,0>l||0>c||0===i?0:0===(t=a*s)?0:100*c*l/t},hasEmbed:function(e){if(!e||3===e.nodeType)return!1;var t=e.classList;return!!t.contains("hasEmbed")||(!!t.contains("continue_reading")||("curveball_container"===e.id||!!e.querySelector("img, iframe, embed, table, video, object, .js-video-placeholder, em, a")&&(t.add("hasEmbed"),!0)))},generateAutoEvtPositions:function(e,t,n,i){var o,a={};if(!e||e.length<=0)return"";for(o=0;o<e.length;o++)this.displayAdsConfig.monSponsorship&&e[o].indexOf("MON")>=0||(a[e[o]]={autoRT:t,autoIV:n,autoMax:i});return this.commentsLREC&&r.forEach(function(e){a[e]={autoDDG:0,autoRT:t,autoIV:n,autoMax:i}}),a}},e.namespace("TD.Viewer").Ads=l},"@VERSION@",{requires:["af-beacon","af-config","af-event"]});
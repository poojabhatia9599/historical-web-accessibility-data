!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-caas",[],t):"object"==typeof exports?exports["wafer-caas"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-caas"]=t())}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="https://s.yimg.com/aaq/wf/",t(t.s="./src/entry.js")}({"./src/base.js":function(e,t,a){"use strict";function r(){return o=a("./src/utils.js")}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o,c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},l=function(){function e(e,t){var a=[],r=!0,n=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,s=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),f=window.wafer,d=f.base,h=f.constants,v=f.utils,m=f.WaferBaseClass,w=h.ATTR_PREFIX,p=v.clearAndSetInnerHTML,y=v.clearTimeout,g=v.convertNodeListToArray,_=v.fetchWithCache,b=v.getConfigFromJSONScriptNode,C=v.getUrlParameterValueByName,P=v.setTimeout,k=["caas-collapsed","caas-url","caas-uuid"],E={},A=function(e){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.caasConfig,i=a.errorClass,o=a.selector,u=a.successClass;n(this,t);var f=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{errorClass:i,selector:o,successClass:u},{STATE_ATTRS:k})),d=e.getAttribute(w+"caas-cache"),h=e.getAttribute(w+"caas-collapsed"),v=e.getAttribute(w+"caas-url"),m=e.getAttribute(w+"caas-uuid"),p=e.getAttribute(w+"caas-cache-strategy")||"cacheFirst",y=e.getAttribute(w+"caas-cache-ttl"),g=e.getAttribute("href"),_=e.getAttribute(w+"caas-prefetch"),C=e.getAttribute(w+"caas-timeout"),E=e.getAttribute(w+"caas-type")||"default",A=e.getAttribute(w+"caas-wrapper"),S=e.getAttribute(w+"caas-dependency"),j=S&&document.querySelector(S),I=(e.getAttribute(w+"caas-trigger-offset")||"").split(" "),O=l(I,2),N=O[0],T=O[1],L=e.getAttribute(w+"caas-item-count-balanced"),x=e.getAttribute(w+"caas-target"),W=x&&e.querySelector(x)||e,M=e.getAttribute(w+"caas-trigger")||"viewport";if(f._util=c({},f._util,{"caas-collapsed":null===h||void 0===h?0:Number(h),"caas-url":v,"caas-uuid":m,cache:null===d||void 0===d?1:Number(d),caasConfig:r,cacheStrategy:p,cacheTtl:null===y||void 0===y?300:Number(y),dependencyElem:j,isPrefetch:null===_||void 0===_?0:Number(_),targetElem:W,timeout:null===C||void 0===C?6e3:Number(C),elem:e,errorClass:i,href:g,type:E,offsetX:Number(T)||0,offsetY:Number(N)||0,selector:o,successClass:u,trigger:M,wrapper:A,isItemCountBalanced:null===L||void 0===L?0:Number(L)}),f._state={shouldPrefetchForViewport:"viewportWithPrefetch"===M,status:status},"sidekick"===E){var D=e.getAttribute(w+"caas-second-node"),V=D&&document.getElementById(D);V&&(f._util.secondNode=V)}else"renderedArticle"===E&&P(function(){var t=e.getElementsByClassName("wafer-caas-data")[0],a=t&&b(t);f.handleRenderedArticle(a)},0,f);return f}return i(t,e),u(t,[{key:"fetch",value:function(){var e=this,t=this._util["caas-url"],a=this._util["caas-uuid"];if(!t&&!a)return Promise.reject(new Error("uuid and url is missing"));var n=this._util,s=n.dependencyElem,i=n.successClass;if(s&&!s.classList.contains(i))return Promise.reject(new Error("dependency not yet complete"));var c=this._util.elem;if(c.classList.contains(i))return Promise.resolve(!0);var u=this._util,f=u.caasConfig,h=void 0===f?{}:f,v=u.cache,m=u.cacheStrategy,w=u.cacheTtl,y=u.errorClass,b=u.secondNode,P=u.targetElem,k=u.timeout,A=u.type,S=a+":1:"+h.contextParams;if(0!==this._state.status){var j=!1;if(t){var I=-1===t.indexOf("?")?"?":"&";t=t+I+h.contextParams}else t=(h.caasUrl||"https://www.yahoo.com/caas/content/article/")+"?uuid="+a+"&"+h.contextParams;return t=(0,(o||r()).getCaaSUrlToUse)(t),c.classList.add("wafer-caas-trigger-inprogress"),this._state.status=0,new Promise(function(e,r){if("default"===A){var n=window.__waferCaasCollection.get(a);if(n)return j=!0,void e(n)}var s={cache:v,cacheKey:S,cacheStrategy:m,cacheTtl:w,timeout:k},i=!0;if(-1===t.indexOf("s.yimg.com")&&(s.credentials="include"),"sidekick"===A){var o=C("uuid",t);if(o){var c=o.split(",")[0];c&&(i=!1,window.wafer.caas.getData([c]).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=l(a,1),i=n[0],o=i||{},c=o.adMeta,u=o.wikiids,f=c.site_attribute||"";s.body=JSON.stringify({wikis:u,siteAttribute:f}),_(t,s).then(function(t){e(t)}).catch(function(e){r(e)})}))}}i&&_(t,s).then(function(t){e(t)}).catch(function(e){r(e)})}).then(function(e){var t=e.assets;if(!t.length)return e;if("sidekick"!==A&&window.CAAS)return e;var a=e.style,n=E[A];return n||(E[A]=(0,(o||r()).loadCaaSAssets)(t,a,A).then(function(){return e}),E[A])}).then(function(r){var n=A.length?A[0].toUpperCase()+A.slice(1):"",s=e["handle"+n],o=r._fetchMeta||{},l=o.duration,u=o.source;d.destroy(c,{destroySelf:!1});var f=void 0;if("default"===A){var h=r||{},v=h.assets,m=h.items,w=void 0===m?[]:m,y={};w.length>1?w.some(function(e){return((e||{}).data||{}).partnerData.uuid===a&&(y=e,!0)}):y=w[0],f=(y||{}).markup,p(P,f),f&&!j&&window.__waferCaasCollection.set(a,{assets:v,items:[y]})}else if("sidekick"===A)if(f=r.markup,b){var _=e._util.isItemCountBalanced,C=document.createElement("div"),k=document.createElement("div");C.innerHTML=f,k.innerHTML=f;for(var E=g(C.getElementsByClassName("sidekick-item")),S=E.length,I=Math.round(S/2)+ +!_,O=I;O<S;O++){var N=E[O].parentNode;N.parentNode.removeChild(N)}p(P,C.innerHTML);for(var T=g(k.getElementsByClassName("sidekick-item")),L=0;L<I;L++){var x=T[L].parentNode;x.parentNode.removeChild(x)}P.innerHTML=C.innerHTML,p(b,k.innerHTML)}else p(P,f);if(e._util["caas-collapsed"]){var W=g(P.getElementsByClassName("caas-body-wrapper"))[0];W&&W.classList.add("caas-body-collapsed")}if(s&&s.call(e,c,r),c.classList.remove("wafer-caas-trigger-inprogress"),c.classList.add(i),d.emitLog({name:"WaferCaas",elem:c,meta:{duration:l,source:j?"MEMORY":u,url:t}}),"default"===A){var M=r.items[0].data.partnerData;d.emitWaferEvent("caas:article:fetch",{elem:c,meta:{data:M,url:t}})}return!0}).catch(function(r){return d.emitWaferEvent("caas:"+("default"===A?"article":A)+":error",{elem:c,meta:{url:t,uuid:a},stack:r.stack}),c.classList.remove("wafer-caas-trigger-inprogress"),c.classList.add(y),c.classList.remove(i),d.destroy(c),e._state.status=2,!1})}return Promise.resolve(!1)}},{key:"handleSidekick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this._util,r=a["caas-url"],n=a.elem,s=a.secondNode;if(!t.markup)return void d.emitWaferEvent("caas:sidekick:error",{elem:n,meta:{url:r}});d.emitWaferEvent("caas:sidekick:init",{elem:n,meta:{url:r}}),this._state.status=1,d.sync(e),s&&d.sync(s)}},{key:"handleRenderedArticle",value:function(e){var t=this._util,a=t["caas-uuid"],r=t.elem,n=t.successClass,s=t.targetElem;if(window.__waferCaasCollection.set(a,{items:[{data:{partnerData:c({},e,{uuid:a})}}]}),this.handleDefault(r),this._util["caas-collapsed"]){var i=g(s.getElementsByClassName("caas-body-wrapper"))[0];i&&i.classList.add("caas-body-collapsed")}r.classList.add(n),d.emitLog({name:"WaferCaas",elem:r,meta:{}})}},{key:"handleDefault",value:function(e){var t=this;if(!this._destroyed){var a=this._util,n=a["caas-uuid"],s=a.elem,i=a.type,c=window.__waferCaasCollection.get(n)||{},u=c.items,f=void 0===u?[]:u,h=l(f,1),v=h[0];v=void 0===v?{}:v;var m=v.data,w=v.markup;if(!("renderedArticle"===i||w&&m))return void d.emitWaferEvent("caas:article:error",{elem:s,meta:{hasData:!!m,hasMarkup:!!w,uuid:n}});var p=m.partnerData;if(window._caasInstance)P(function(){t._destroyed||(window._caasInstance.sync(),d.sync(e))},window.__waferCaasRenderInProgress?300:0,this);else{var g=this._util.wrapper;window.wafer.base.pauseVideo("wafer-caas"),window._caasInstance=new window.CAAS.BASE({container:g}),window._caasInstance.on("yvideo:scriptLoadingError",function(e){d.emitError({name:"WaferCaas",elem:null,meta:{message:"Could not load js"},stack:e.stack})}),window._caasInstance.on("link:clicked",function(e){if(e.isYahoo){var a=t._util.caasConfig,i=void 0===a?{}:a,c=i.contextParams,u=void 0===c?{}:c,f=(i.caasUrl||"https://www.yahoo.com/caas/content/article/")+"?url="+e.href+"&"+u;return d.emitWaferEvent("caas:yahooLink:clicked",{elem:s,meta:{data:e,instance:window._caasInstance}}),_(f,{timeout:2e3}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.items,a=void 0===t?[]:t,n=e.assets;return(0,(o||r()).handlePrefetchedData)(a,n,u)}).then(function(t){var a=l(t,1),r=a[0];r=void 0===r?{}:r;var i=r.data,o=i.partnerData,c=void 0===o?{}:o,u=c.uuid;d.emitWaferEvent("caas:yahooLink:fetched",{elem:s,meta:{data:Object.assign({parentUuid:n,uuid:u},e),instance:window._caasInstance}})}).catch(function(){d.emitWaferEvent("caas:link:clicked",{elem:s,meta:{data:e,instance:window._caasInstance}})})}d.emitWaferEvent("caas:link:clicked",{elem:s,meta:{data:e,instance:window._caasInstance}})}),this._state.status=1,d.emitWaferEvent("caas:article:init",{elem:s,meta:{data:p,instance:window._caasInstance}}),d.sync(e)}window.__waferCaasRenderInProgress=!0,y(window.__waferCaasRenderInProgressTimeout),window.__waferCaasRenderInProgressTimeout=P(function(){window.__waferCaasRenderInProgress=!1},300,this),this._state.status=1}}},{key:"handleArticleInViewport",value:function(){var e=this._util,t=e.elem,a=e.type,r=e["caas-uuid"],n=window.__waferCaasCollection.get(r)||{},s=n.items,i=void 0===s?[]:s,o=l(i,1),c=o[0];c=void 0===c?{}:c;var u=c.data,f=c.markup;if("renderedArticle"===a||f&&u){var h=u.partnerData;d.emitWaferEvent("caas:article:inview",{elem:t,meta:{data:h,instance:window._caasInstance}})}}},{key:"stateDidUpdate",value:function(){if("caas-collapsed"!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).stateAttr)"stateChange"===this._util.trigger&&this.fetch().catch(function(){});else{if(!this._util.targetElem)return;if(this._util["caas-collapsed"]=Number(this._util["caas-collapsed"]),this._util["caas-collapsed"]){var e=g(this._util.targetElem.getElementsByClassName("caas-body-wrapper"))[0];e&&e.classList.add("caas-body-collapsed")}}}},{key:"config",get:function(){var e=this._util,t=e["caas-url"],a=e["caas-uuid"],r=e.caasConfig,n=e.elem,s=e.href,i=e.isPrefetch,o=e.offsetX,c=e.offsetY,l=e.selector,u=e.trigger,f=e.type;return{caasConfig:r,elem:n,href:s,isPrefetch:i,offsetX:o,offsetY:c,selector:l,shouldPrefetchForViewport:this._state.shouldPrefetchForViewport,trigger:u,type:f,url:t,uuid:a}}},{key:"shouldPrefetchForViewport",set:function(e){this._state.shouldPrefetchForViewport=e}}]),t}(m);t.default=A,e.exports=t.default},"./src/controller.js":function(e,t,a){"use strict";function r(){return l=s(a("./src/base.js"))}function n(){return u=a("./src/utils.js")}function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l,u,f=function(){function e(e,t){var a=[],r=!0,n=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,s=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),h=window.wafer,v=h.base,m=h.utils,w=m.elementInView,p=m.fetchWithCache,y=m.getConfigFromJSONScriptNode,g=m.getWaferInstanceForElem,_=m.throttle,b=void 0,C=window.wafer.controllers.WaferBaseController;window.__waferCaasCollection=function(){var e=[],t=new Map,a={};return{set:function(a,r){e.push(a),t.set(a,r)},freeMemory:function(){var r=e.length-25;if(!(r<=0))for(var n=0;n<=r;n++){var s=e[0];a[s]||(e.splice(0,1),t.delete(s))}},get:function(e){return a[e]=!0,t.get(e)},clearVisitedNodes:function(){a={}}}}();var P=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.errorClass,n=void 0===a?"wafer-caas-error":a,s=e.root,c=void 0===s?document:s,u=e.selector,f=e.successClass,d=void 0===f?"wafer-caas-complete":f,h=e.validateDelay,v=void 0===h?25:h;i(this,t);var m=y(document.getElementById("wafer-caas-config"));if(m.caasUrl){var w=location,p=w.hostname,g=w.port,b=w.protocol;"localhost"===p||"4443"===g||"https:"!==b||m.mock||(m.caasUrl="/caas/content/article/")}var C=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{root:c,selector:u,props:{caasConfig:m,errorClass:n,selector:u,successClass:d},WaferClass:(l||r()).default}));return C._validateWithThrottle=_(function(){C.validate()},v,C),C._state=C._state||{},C._state.progressLoader=null,C.sync(),C.addPublicAPIs(m),C}return c(t,e),d(t,[{key:"addPublicAPIs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contextParams,a=void 0===t?{}:t;window.wafer.caas||(window.wafer.caas={getData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map(function(e){return new Promise(function(t){var r=window.__waferCaasCollection.get(e);if(r){var n=f(r.items,1),s=n[0].data;return t((void 0===s?{}:s).partnerData||{})}if(!window.wafer.db)return t({});window.wafer.db.get(e+":1:"+a,"fetch",{timeout:3e3}).then(function(e){try{var a=JSON.parse(e.value),r=a.items,n=f(r,1),s=n[0].data;return t((void 0===s?{}:s).partnerData||{})}catch(e){return t({})}}).catch(function(e){t({})})})}))}})}},{key:"prefetch",value:function(){var e=this._state.elementInstances,t={},a=[],r=[],s=void 0,i=void 0,o=void 0,c=0,l=0,f=!0,d=!1,h=void 0;try{for(var m,w=e.values()[Symbol.iterator]();!(f=(m=w.next()).done);f=!0){var y=m.value;a[c]=a[c]||[];var g=y.instance,_=g.config,C=_.caasConfig,P=void 0===C?{}:C,k=_.elem,E=_.href,A=_.isPrefetch,S=_.shouldPrefetchForViewport,j=_.uuid;if(o=o||P.caasUrl,i=i||P.contextParams||"",(A||S)&&j){var I=t[j];!I&&a[c].push({href:E,uuid:j}),t[j]=!0,S?(k.classList.add("did-prefetch"),g.shouldPrefetchForViewport=!1):g.destroy(),!I&&++l>=10&&(l=0,c++)}}}catch(e){d=!0,h=e}finally{try{!f&&w.return&&w.return()}finally{if(d)throw h}}return Promise.all(a.map(function(e){var t=e.map(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).uuid});if(t.length)return s=(o||"https://www.yahoo.com/caas/content/article/")+"?uuid="+t.join(",")+"&"+i,s=(0,(u||n()).getCaaSUrlToUse)(s),p(s,{cache:0}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.assets,a=e.items,r=void 0===a?[]:a,s={items:r,assets:t};return window.CAAS?s:b||(b=(0,(u||n()).loadCaaSAssets)(t,"","default").then(function(){return s}))}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.assets,s=t.items,o=void 0===s?[]:s;return(0,(u||n()).handlePrefetchedData)(o,a,i,function(t){var a=e[t].href;a&&r.push(a)})})})).then(function(){if(r.length)return Promise.all(r.map(function(e){return p((o||"https://www.yahoo.com/caas/content/article/")+"?url="+e+"&"+i,{cache:0}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.items,a=void 0===t?[]:t,r=e.assets;return(0,(u||n()).handlePrefetchedData)(a,r,i)})}))}).then(function(){v.emitWaferEvent("caas:prefetch:success",{meta:{url:s}})}).catch(function(){v.emitWaferEvent("caas:prefetch:failed",{meta:{url:s}})})}},{key:"handleScroll",value:function(){this._validateWithThrottle()}},{key:"handleResize",value:function(){this._validateWithThrottle()}},{key:"didSync",value:function(){var e=this,t=this._state,a=t.elementInstances,r=t.mounted;0===a.size||r||(this._state.mounted=!0),setTimeout(function(){e.prefetch()},10)}},{key:"trigger",value:function(e){var t=this._state.elementInstances.get(e);if(t){var a=t.instance;if("renderedArticle"===a.config.type)return;a.fetch()}}},{key:"willValidate",value:function(e){var t=this,a=this._state.elementInstances;e.forEach(function(e){var r=a.get(e),n=r.instance;if(!n.config.isPrefetch){var s=n.config,i=s.offsetX,o=s.offsetY,c=s.selector,l=s.trigger,u=s.type,f=w(e,{offsetX:i,offsetY:o},v.viewport);if("renderedArticle"!==u)switch(l){case"viewport":case"viewportWithPrefetch":1!==n._state.status&&f&&n.fetch().then(function(t){t&&c&&e.classList.remove(c.replace(".",""))}).catch(function(){});break;case"onLoad":n.fetch().then(function(t){t&&c&&e.classList.remove(c.replace(".",""))}).catch(function(){})}if((!f||t._state.activeElem!==e)&&(!t._state.activeElem||!w(t._state.activeElem,{offsetX:i,offsetY:o},v.viewport))&&1===n._state.status&&f&&("default"===u||"renderedArticle"===u)&&t._state.activeElem!==e){var d=t._state.progressLoader;d&&!d._destroyed||(t._state.progressLoader=g(document.getElementsByClassName("wafer-caas-progress-loader")[0],"wafer-progress-loader")),d=t._state.progressLoader,d&&(d.instance.target=e),n.handleArticleInViewport(),t._state.activeElem=e}}})}},{key:"didDestroy",value:function(){var e=!0,t=this._state.elementInstances,a=!0,r=!1,n=void 0;try{for(var s,i=t.values()[Symbol.iterator]();!(a=(s=i.next()).done);a=!0){var o=s.value,c=o.instance.config,l=c.isPrefetch;if("default"===c.type&&!l){e=!1;break}}}catch(e){r=!0,n=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw n}}e&&(window._caasInstance&&(window._caasInstance.destructor(),window._caasInstance=null,window.__waferCaasCollection.clearVisitedNodes()),window.wafer.base.resumeVideo("wafer-caas"))}}]),t}(C);t.default=P,e.exports=t.default},"./src/entry.js":function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n;t.default=new((n||function(){return n=r(a("./src/controller.js"))}()).default)({selector:"wafer-caas"}),e.exports=t.default},"./src/utils.js":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=window.wafer,n=r.features,s=r.utils,i=s.getUrlParameterValueByName,o=s.loadCSSSync,c=s.loadScriptAsync,l=/^https:\/\/s.yimg.com\/(os|aaq)\/c/,u=function(e,t,a){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),n=-1!==e.indexOf("?")?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+a+"$2"):e+n+t+"="+a};t.handlePrefetchedData=function(e,t,a,r){return Promise.all(e.map(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],s=e.data,i=void 0===s?{}:s,o=e.markup,c=i.partnerData;if(!c||!o)return r&&r(n),Promise.resolve();var l=c.uuid,u={assets:t,items:[e]};return window.__waferCaasCollection.set(l,u),window.wafer.db.set({cachedTime:Date.now(),key:l+":1:"+a,ttl:1200,value:JSON.stringify(u)},"fetch").then(function(t){return t&&window.__waferCaasCollection.freeMemory(),e}).catch(function(){return e})}))},t.loadCaaSAssets=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments[2];return new Promise(function(r){var n="sidekick"===a?"CAAS_SIDEKICK":"CAAS",s=void 0,i=!0,u=!0;window.__caasModules=window.__caasModules||{},e.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,a=e.asset;"js"===t&&a.value&&(i=!1),"css"===t&&(u=!1)}),e.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.type,f=e.asset;s=(void 0===f?{}:f).value,l.test(s)&&("js"===a?c({src:s},function(){i=!0,u&&r()},n):"css"===a&&(window.__caasModules[n]?(u=!0,i&&r()):(window.__caasModules[n]=!0,o({src:s,text:t},function(){u=!0,i&&r()}))))})})},t.getCaaSUrlToUse=function(e){if(n.isPWA){i("features",e)?e=u(e,"features",n+",pwa"):e+="&features=pwa"}return e}}})});